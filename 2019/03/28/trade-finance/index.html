<!DOCTYPE html><html lang="zh-TW" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>trade-finance-logistics网络运行与分析 | KANGEL</title><meta name="description" content="trade-finance-logistics网络运行与分析"><meta name="keywords" content="blockchain,hyperledger"><meta name="author" content="kangel"><meta name="copyright" content="kangel"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/2.png"><link rel="preconnect" href="//cdn.jsdelivr.net"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="trade-finance-logistics网络运行与分析"><meta name="twitter:description" content="trade-finance-logistics网络运行与分析"><meta name="twitter:image" content="https://j-kangel.github.io/article_cover/0-6.jpg"><meta property="og:type" content="article"><meta property="og:title" content="trade-finance-logistics网络运行与分析"><meta property="og:url" content="https://j-kangel.github.io/2019/03/28/trade-finance/"><meta property="og:site_name" content="KANGEL"><meta property="og:description" content="trade-finance-logistics网络运行与分析"><meta property="og:image" content="https://j-kangel.github.io/article_cover/0-6.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.15/dist/snackbar.min.css"><link rel="canonical" href="https://j-kangel.github.io/2019/03/28/trade-finance/"><link rel="prev" title="hash长度扩展攻击" href="https://j-kangel.github.io/2019/04/05/hash-attack/"><link rel="next" title="使用docker部署静态网站" href="https://j-kangel.github.io/2019/03/25/docker/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  highlight_lang: 'false',
  highlight_shrink: 'false',
  copy: {
    success: '複製成功',
    error: '複製錯誤',
    noSupport: '瀏覽器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '鍵將本頁加入書籤'
  },
  runtime_unit: '天',
  copyright: undefined,
  copy_copyright_js: false,
  ClickShowText: undefined,
  medium_zoom: 'true',
  Snackbar: {"bookmark":{"title":"Snackbar.bookmark.title","message_prev":"按","message_next":"鍵將本頁加入書籤"},"chs_to_cht":"你已切換為繁體","cht_to_chs":"你已切換為簡體","day_to_night":"你已切換為深色模式","night_to_day":"你已切換為淺色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"}
  
}</script></head><body><div id="header"> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">KANGEL</a></span><i class="fa fa-bars fa-fw toggle-menu pull_right close" aria-hidden="true"></i><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li><li><a class="site-page" href="/photo/"><i class="fa-fw fa fa-photo"></i><span> Photo</span></a></li></ul></div></div></span><span class="pull_right" id="search_button"></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lazyload avatar_img" src="/img/2.png" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">29</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">標籤</div><div class="length_num">24</div></a></div></div><div class="mobile_data_item is_center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分類</div><div class="length_num">11</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li><li><a class="site-page" href="/photo/"><i class="fa-fw fa fa-photo"></i><span> Photo</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目錄</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#一、trade-finance-logistics网络介绍"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">一、trade-finance-logistics网络介绍</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#1、工作交易流程"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">1、工作交易流程</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#2、构建fabric网络"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">2、构建fabric网络</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#二、环境准备"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">二、环境准备</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#1、hyperledger-fabric环境搭建"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">1、hyperledger fabric环境搭建</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#2、trade-finance-logistics网络的下载"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">2、trade-finance-logistics网络的下载</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#3、设置cryptogen环境变量"><span class="toc_mobile_items-number">2.3.</span> <span class="toc_mobile_items-text">3、设置cryptogen环境变量</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#4、更改配置文件configtx-yaml"><span class="toc_mobile_items-number">2.4.</span> <span class="toc_mobile_items-text">4、更改配置文件configtx.yaml</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#三、创建channel并运行网络"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">三、创建channel并运行网络</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#1、创建通道channel"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">1、创建通道channel</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#2、启动网络"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text">2、启动网络</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#3、关闭网络"><span class="toc_mobile_items-number">3.3.</span> <span class="toc_mobile_items-text">3、关闭网络</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#四、生成通道文件分析"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">四、生成通道文件分析</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#1、网络加密材料配置文件crypto-config-yaml剖析"><span class="toc_mobile_items-number">4.1.</span> <span class="toc_mobile_items-text">1、网络加密材料配置文件crypto-config.yaml剖析</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#2、生成所有组织加密材料"><span class="toc_mobile_items-number">4.2.</span> <span class="toc_mobile_items-text">2、生成所有组织加密材料</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#3、通道及锚节点的配置-configtx-yaml-配置剖析"><span class="toc_mobile_items-number">4.3.</span> <span class="toc_mobile_items-text">3、通道及锚节点的配置  configtx.yaml 配置剖析</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#4、通道工件配置channel-artifacts剖析"><span class="toc_mobile_items-number">4.4.</span> <span class="toc_mobile_items-text">4、通道工件配置channel-artifacts剖析</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#四、示例贸易网络分析"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">四、示例贸易网络分析</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#1、相关docker镜像及配置"><span class="toc_mobile_items-number">5.1.</span> <span class="toc_mobile_items-text">1、相关docker镜像及配置</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#2、peer-base-yaml配置剖析"><span class="toc_mobile_items-number">5.2.</span> <span class="toc_mobile_items-text">2、peer-base.yaml配置剖析</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#3、docker-compose-base-yaml配置剖析"><span class="toc_mobile_items-number">5.3.</span> <span class="toc_mobile_items-text">3、docker-compose-base.yaml配置剖析</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#4、docker-compose-e2e-yaml配置剖析"><span class="toc_mobile_items-number">5.4.</span> <span class="toc_mobile_items-text">4、docker-compose-e2e.yaml配置剖析</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#五、启动样本交易网络"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">五、启动样本交易网络</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#1、启动网络"><span class="toc_mobile_items-number">6.1.</span> <span class="toc_mobile_items-text">1、启动网络</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#2、查看docker进程"><span class="toc_mobile_items-number">6.2.</span> <span class="toc_mobile_items-text">2、查看docker进程</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#3、查看服务"><span class="toc_mobile_items-number">6.3.</span> <span class="toc_mobile_items-text">3、查看服务</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#4、关闭网络"><span class="toc_mobile_items-number">6.4.</span> <span class="toc_mobile_items-text">4、关闭网络</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#六、总结"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text">六、总结</span></a></li></ol></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目錄</div><div class="sidebar-toc__progress"><span class="progress-notice">你已經讀了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#一、trade-finance-logistics网络介绍"><span class="toc-number">1.</span> <span class="toc-text">一、trade-finance-logistics网络介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、工作交易流程"><span class="toc-number">1.1.</span> <span class="toc-text">1、工作交易流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、构建fabric网络"><span class="toc-number">1.2.</span> <span class="toc-text">2、构建fabric网络</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二、环境准备"><span class="toc-number">2.</span> <span class="toc-text">二、环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、hyperledger-fabric环境搭建"><span class="toc-number">2.1.</span> <span class="toc-text">1、hyperledger fabric环境搭建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、trade-finance-logistics网络的下载"><span class="toc-number">2.2.</span> <span class="toc-text">2、trade-finance-logistics网络的下载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3、设置cryptogen环境变量"><span class="toc-number">2.3.</span> <span class="toc-text">3、设置cryptogen环境变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4、更改配置文件configtx-yaml"><span class="toc-number">2.4.</span> <span class="toc-text">4、更改配置文件configtx.yaml</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三、创建channel并运行网络"><span class="toc-number">3.</span> <span class="toc-text">三、创建channel并运行网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、创建通道channel"><span class="toc-number">3.1.</span> <span class="toc-text">1、创建通道channel</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、启动网络"><span class="toc-number">3.2.</span> <span class="toc-text">2、启动网络</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3、关闭网络"><span class="toc-number">3.3.</span> <span class="toc-text">3、关闭网络</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#四、生成通道文件分析"><span class="toc-number">4.</span> <span class="toc-text">四、生成通道文件分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、网络加密材料配置文件crypto-config-yaml剖析"><span class="toc-number">4.1.</span> <span class="toc-text">1、网络加密材料配置文件crypto-config.yaml剖析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、生成所有组织加密材料"><span class="toc-number">4.2.</span> <span class="toc-text">2、生成所有组织加密材料</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3、通道及锚节点的配置-configtx-yaml-配置剖析"><span class="toc-number">4.3.</span> <span class="toc-text">3、通道及锚节点的配置  configtx.yaml 配置剖析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4、通道工件配置channel-artifacts剖析"><span class="toc-number">4.4.</span> <span class="toc-text">4、通道工件配置channel-artifacts剖析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#四、示例贸易网络分析"><span class="toc-number">5.</span> <span class="toc-text">四、示例贸易网络分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、相关docker镜像及配置"><span class="toc-number">5.1.</span> <span class="toc-text">1、相关docker镜像及配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、peer-base-yaml配置剖析"><span class="toc-number">5.2.</span> <span class="toc-text">2、peer-base.yaml配置剖析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3、docker-compose-base-yaml配置剖析"><span class="toc-number">5.3.</span> <span class="toc-text">3、docker-compose-base.yaml配置剖析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4、docker-compose-e2e-yaml配置剖析"><span class="toc-number">5.4.</span> <span class="toc-text">4、docker-compose-e2e.yaml配置剖析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#五、启动样本交易网络"><span class="toc-number">6.</span> <span class="toc-text">五、启动样本交易网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、启动网络"><span class="toc-number">6.1.</span> <span class="toc-text">1、启动网络</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、查看docker进程"><span class="toc-number">6.2.</span> <span class="toc-text">2、查看docker进程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3、查看服务"><span class="toc-number">6.3.</span> <span class="toc-text">3、查看服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4、关闭网络"><span class="toc-number">6.4.</span> <span class="toc-text">4、关闭网络</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#六、总结"><span class="toc-number">7.</span> <span class="toc-text">六、总结</span></a></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/article_cover/0-6.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">trade-finance-logistics网络运行与分析</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 發表於 2019-03-27<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新於 2019-04-04</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/区块链学习/">区块链学习</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon" aria-hidden="true"></i><span>字數總計: </span><span class="word-count">3.4k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon" aria-hidden="true"></i><span>閲讀時長: 14 分鐘</span><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true">       </i><span>閲讀量: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h3 id="一、trade-finance-logistics网络介绍"><a href="#一、trade-finance-logistics网络介绍" class="headerlink" title="一、trade-finance-logistics网络介绍"></a>一、trade-finance-logistics网络介绍</h3><h4 id="1、工作交易流程"><a href="#1、工作交易流程" class="headerlink" title="1、工作交易流程"></a>1、工作交易流程</h4><p>工作流程中的交易如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1. 进口商要求出口商提供货物以换取货币</span><br><span class="line">2. 出口商接受贸易协议</span><br><span class="line">3. 进口商要求银行提供有利于出口商的信用证</span><br><span class="line">4. 进口商的银行提供有利于出口商的信用证，并可支付给后者的银行</span><br><span class="line">5. 出口商的银行代表出口商接受信用证</span><br><span class="line">6. 出口商向监管机构申请E / L.</span><br><span class="line">7. 监管机构向出口商提供E / L.</span><br><span class="line">8. 出口商准备一批货物并将其交给承运人</span><br><span class="line">9. 承运人在确认E / L后接受货物，然后向出口商提供提单</span><br><span class="line">10. 出口商的银行要求进口商银行支付一半的款项</span><br><span class="line">11. 进口商的银行将一半的金额转移到出口商的银行</span><br><span class="line">12. 承运人将货物运至目的地</span><br><span class="line">13. 进口商的银行向出口商的银行支付剩余金额</span><br></pre></td></tr></table></figure>
<p>这是一个解释交易工作流程的图表：</p>
<p><img alt="" data-src="/2019/03/28/trade-finance/1.png" class="lazyload"></p>
<h4 id="2、构建fabric网络"><a href="#2、构建fabric网络" class="headerlink" title="2、构建fabric网络"></a>2、构建fabric网络</h4><p>样本贸易网络将由四个组织组成，分别代表出口商，进口商，承运商和监管机构。后两者分别代表运营商和监管机构实体。但是，出口组织既代表出口实体又代表其银行。同样，进口商组织代表进口实体及其银行。如下图所示：</p>
<p><img alt="" data-src="/2019/03/28/trade-finance/2.png" class="lazyload"></p>
<h3 id="二、环境准备"><a href="#二、环境准备" class="headerlink" title="二、环境准备"></a>二、环境准备</h3><h4 id="1、hyperledger-fabric环境搭建"><a href="#1、hyperledger-fabric环境搭建" class="headerlink" title="1、hyperledger fabric环境搭建"></a>1、hyperledger fabric环境搭建</h4><p>具体过程见<a href="https://j-kangel.github.io/2019/03/24/hyperledger/">https://j-kangel.github.io/2019/03/24/hyperledger/</a></p>
<h4 id="2、trade-finance-logistics网络的下载"><a href="#2、trade-finance-logistics网络的下载" class="headerlink" title="2、trade-finance-logistics网络的下载"></a>2、trade-finance-logistics网络的下载</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src  </span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/HyperledgerHandsOn/trade-finance-logistics.git</span><br></pre></td></tr></table></figure>
<h4 id="3、设置cryptogen环境变量"><a href="#3、设置cryptogen环境变量" class="headerlink" title="3、设置cryptogen环境变量"></a>3、设置cryptogen环境变量</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:~/go/src/github.com/hyperledger/fabric/fabric-samples/bin</span><br><span class="line">$ cryptogen version   <span class="comment">#测试是否生效</span></span><br><span class="line">cryptogen:</span><br><span class="line"> Version: 1.4.0</span><br><span class="line"> Commit SHA: d700b43</span><br><span class="line"> Go version: go1.11.1</span><br><span class="line"> OS/Arch: linux/amd64</span><br></pre></td></tr></table></figure>
<h4 id="4、更改配置文件configtx-yaml"><a href="#4、更改配置文件configtx-yaml" class="headerlink" title="4、更改配置文件configtx.yaml"></a>4、更改配置文件configtx.yaml</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> go/src/trade-finance-logistics/network</span><br><span class="line">$ gedit configtx.yaml</span><br></pre></td></tr></table></figure>
<p>将以下内容移至文件末尾，这是因为hyperledger fabric1.4更新的语法规则</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Profiles:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    FourOrgsTradeOrdererGenesis:</span></span><br><span class="line"><span class="attr">        Capabilities:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*ChannelCapabilities</span></span><br><span class="line"><span class="attr">        Orderer:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererDefaults</span></span><br><span class="line"><span class="attr">            Organizations:</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*TradeOrdererOrg</span></span><br><span class="line"><span class="attr">            Capabilities:</span></span><br><span class="line">                <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererCapabilities</span></span><br><span class="line"><span class="attr">        Consortiums:</span></span><br><span class="line"><span class="attr">            TradeConsortium:</span></span><br><span class="line"><span class="attr">                Organizations:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="meta">*ExporterOrg</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="meta">*ImporterOrg</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="meta">*CarrierOrg</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="meta">*RegulatorOrg</span></span><br><span class="line"><span class="attr">    FourOrgsTradeChannel:</span></span><br><span class="line"><span class="attr">        Consortium:</span> <span class="string">TradeConsortium</span></span><br><span class="line"><span class="attr">        Application:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*ApplicationDefaults</span></span><br><span class="line"><span class="attr">            Organizations:</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*ExporterOrg</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*ImporterOrg</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*CarrierOrg</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*RegulatorOrg</span></span><br><span class="line"><span class="attr">            Capabilities:</span></span><br><span class="line">                <span class="string">&lt;&lt;:</span> <span class="meta">*ApplicationCapabilities</span></span><br></pre></td></tr></table></figure>
<h3 id="三、创建channel并运行网络"><a href="#三、创建channel并运行网络" class="headerlink" title="三、创建channel并运行网络"></a>三、创建channel并运行网络</h3><h4 id="1、创建通道channel"><a href="#1、创建通道channel" class="headerlink" title="1、创建通道channel"></a>1、创建通道channel</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> go/src/trade-finance-logistics/network</span><br><span class="line">$ ./trade.sh generate -c tradechannel</span><br></pre></td></tr></table></figure>
<p>此时会创建一个排序节点（orderer）和四个对等锚节点（ImporterOrg、ExporterOrg、RegulatorOrg、CarrierOrg），并生成相应的配置文件，稍后详细分析。</p>
<h4 id="2、启动网络"><a href="#2、启动网络" class="headerlink" title="2、启动网络"></a>2、启动网络</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./trade.sh up -c tradechannel</span><br></pre></td></tr></table></figure>
<p>启动成功后显示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Starting with channel <span class="string">'tradechannel'</span></span><br><span class="line">Continue? [Y/n] </span><br><span class="line">proceeding ...</span><br><span class="line">LOCAL_VERSION=1.4.0</span><br><span class="line">DOCKER_IMAGE_VERSION=1.4.0</span><br></pre></td></tr></table></figure>
<h4 id="3、关闭网络"><a href="#3、关闭网络" class="headerlink" title="3、关闭网络"></a>3、关闭网络</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./trade.sh down -c tradechannel</span><br></pre></td></tr></table></figure>
<p>关闭成功后显示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Stopping ca_peerImporterOrg           ... <span class="keyword">done</span>    <span class="comment">#停止进口商节点证书</span></span><br><span class="line">Stopping ca_peerRegulatorOrg          ... <span class="keyword">done</span></span><br><span class="line">Stopping ca_peerExporterOrg           ... <span class="keyword">done</span></span><br><span class="line">Stopping ca_peerCarrierOrg            ... <span class="keyword">done</span></span><br><span class="line">Stopping peer0.importerorg.trade.com  ... <span class="keyword">done</span>    <span class="comment">#停止进口商节点</span></span><br><span class="line">Stopping peer0.carrierorg.trade.com   ... <span class="keyword">done</span></span><br><span class="line">Stopping peer0.regulatororg.trade.com ... <span class="keyword">done</span></span><br><span class="line">Stopping orderer.trade.com            ... <span class="keyword">done</span></span><br><span class="line">Stopping peer0.exporterorg.trade.com  ... <span class="keyword">done</span></span><br><span class="line">Removing ca_peerImporterOrg           ... <span class="keyword">done</span>    <span class="comment">#移除进口商节点证书</span></span><br><span class="line">Removing ca_peerRegulatorOrg          ... <span class="keyword">done</span></span><br><span class="line">Removing ca_peerExporterOrg           ... <span class="keyword">done</span></span><br><span class="line">Removing ca_peerCarrierOrg            ... <span class="keyword">done</span></span><br><span class="line">Removing peer0.importerorg.trade.com  ... <span class="keyword">done</span>    <span class="comment">#移除进口商节点</span></span><br><span class="line">Removing peer0.carrierorg.trade.com   ... <span class="keyword">done</span></span><br><span class="line">Removing peer0.regulatororg.trade.com ... <span class="keyword">done</span></span><br><span class="line">Removing orderer.trade.com            ... <span class="keyword">done</span></span><br><span class="line">Removing peer0.exporterorg.trade.com  ... <span class="keyword">done</span></span><br><span class="line">Removing network net_trade</span><br><span class="line">Removing volume net_orderer.trade.com</span><br><span class="line">Removing volume net_peer0.exporterorg.trade.com</span><br><span class="line">Removing volume net_peer0.importerorg.trade.com</span><br><span class="line">Removing volume net_peer0.regulatororg.trade.com</span><br><span class="line">Removing volume net_peer0.carrierorg.trade.com</span><br></pre></td></tr></table></figure>
<h3 id="四、生成通道文件分析"><a href="#四、生成通道文件分析" class="headerlink" title="四、生成通道文件分析"></a>四、生成通道文件分析</h3><h4 id="1、网络加密材料配置文件crypto-config-yaml剖析"><a href="#1、网络加密材料配置文件crypto-config-yaml剖析" class="headerlink" title="1、网络加密材料配置文件crypto-config.yaml剖析"></a>1、网络加密材料配置文件crypto-config.yaml剖析</h4><p>该网络包含一个排序组织和四个对等节点组织，具体关系如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># "OrdererOrgs" - Definition of organizations managing orderer nodes</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="attr">OrdererOrgs:</span>  <span class="comment">##管理orderer节点的组织的定义</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">TradeOrderer</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># "PeerOrgs" - Definition of organizations managing peer nodes</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="attr">PeerOrgs:</span>    <span class="comment">##管理Peer节点的组织的定义</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">ExporterOrg</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">ImporterOrg</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">CarrierOrg</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">RegulatorOrg</span></span><br></pre></td></tr></table></figure>
<p>每个组织都有各自的属性，下面以ImporterOrg为例</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ImporterOrg</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="attr">- Name:</span> <span class="string">ImporterOrg</span>     <span class="comment">##组织名称</span></span><br><span class="line"><span class="attr">  Domain:</span> <span class="string">importerorg.trade.com</span>   <span class="comment">##组织域名</span></span><br><span class="line"><span class="attr">  EnableNodeOUs:</span> <span class="literal">true</span>             <span class="comment">##如果设置了EnableNodeOUs，就在msp下生成config.yaml文件</span></span><br><span class="line"><span class="attr">  Template:</span></span><br><span class="line"><span class="attr">    Count:</span> <span class="number">1</span>            <span class="comment">##表示生成一个peer</span></span><br><span class="line"><span class="attr">  Users:</span></span><br><span class="line"><span class="attr">    Count:</span> <span class="number">2</span>            <span class="comment">##表示生成两个普通用户</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br></pre></td></tr></table></figure>
<h4 id="2、生成所有组织加密材料"><a href="#2、生成所有组织加密材料" class="headerlink" title="2、生成所有组织加密材料"></a>2、生成所有组织加密材料</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cryptogen generate --config=./crypto-config.yaml  <span class="comment">##./trade.sh generate第一部分</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ tree -L 2 crypto-config   <span class="comment">##查看crypto-config的二级目录</span></span><br><span class="line">crypto-config</span><br><span class="line">├── ordererOrganizations    <span class="comment">##order组织只有一个</span></span><br><span class="line">│   └── trade.com</span><br><span class="line">└── peerOrganizations       <span class="comment">##peer组织有四个</span></span><br><span class="line">    ├── carrierorg.trade.com</span><br><span class="line">    ├── exporterorg.trade.com</span><br><span class="line">    ├── importerorg.trade.com</span><br><span class="line">    └── regulatororg.trade.com</span><br></pre></td></tr></table></figure>
<p>现在以trade.com为例进行展开分析</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">$ tree  crypto-config/ordererOrganizations/trade.com/</span><br><span class="line">crypto-config/ordererOrganizations/trade.com/</span><br><span class="line">├── ca   <span class="comment">## 存放组织根证书及私钥(采用EC算法)证书为【自签名】，组织内的实体将给予该根证书作为证书根</span></span><br><span class="line">│   ├── ca.trade.com-cert.pem  <span class="comment">## 证书CA</span></span><br><span class="line">│   └── d046c897334d539608c5fa578e7686441ec41115702ff8105e22998785839612_sk  <span class="comment">## 私钥</span></span><br><span class="line">├── msp  <span class="comment">## 存放该组织身份信息</span></span><br><span class="line">│   ├── admincerts  <span class="comment">## 组织管理员身份验证证书，【被根证书签名】</span></span><br><span class="line">│   │   └── Admin@trade.com-cert.pem  </span><br><span class="line">│   ├── cacerts     <span class="comment">## 组织的根证书 【和CA目录里面一致】</span></span><br><span class="line">│   │   └── ca.trade.com-cert.pem  </span><br><span class="line">│   └── tlscacerts  <span class="comment">## 用于TLS的CA证书，【自签名】</span></span><br><span class="line">│       └── tlsca.trade.com-cert.pem</span><br><span class="line">├── orderers  <span class="comment">## 存放所有 Orderer 的身份信息</span></span><br><span class="line">│   └── orderer.trade.com   <span class="comment">## 第一个Orderer的信息msp及tls</span></span><br><span class="line">│       ├── msp</span><br><span class="line">│       │   ├── admincerts  <span class="comment">## 组织管理员身份验证证书 </span></span><br><span class="line">│       │   │   └── Admin@trade.com-cert.pem</span><br><span class="line">│       │   ├── cacerts</span><br><span class="line">│       │   │   └── ca.trade.com-cert.pem</span><br><span class="line">│       │   ├── keystore  <span class="comment">## 本节点的身份私钥，用来签名</span></span><br><span class="line">│       │   │   └── 38195f71e2b520910f2a2e405764975e235c7d97ff6a7fde41127e1575888375_sk</span><br><span class="line">│       │   ├── signcerts  <span class="comment">## 验证本节点签名的证书，【被根证书签名】</span></span><br><span class="line">│       │   │   └── orderer.trade.com-cert.pem</span><br><span class="line">│       │   └── tlscacerts  <span class="comment">## TLS连接用的身份证书，【和msp.tlscacerts一致】</span></span><br><span class="line">│       │       └── tlsca.trade.com-cert.pem</span><br><span class="line">│       └── tls  <span class="comment">## tls 的相关信息</span></span><br><span class="line">│           ├── ca.crt   <span class="comment">##【组织的根证书】</span></span><br><span class="line">│           ├── server.crt  <span class="comment">## 验证本节点签名的证书，【被根证书签名】</span></span><br><span class="line">│           └── server.key  <span class="comment">## 本节点的身份私钥，用来签名</span></span><br><span class="line">├── tlsca  <span class="comment">## 存放tls相关的证书和私钥</span></span><br><span class="line">│   ├── acbada48c339b2b60cb9bac3914f359722f37de001628f110792153d8614c443_sk</span><br><span class="line">│   └── tlsca.trade.com-cert.pem</span><br><span class="line">└── users  <span class="comment">##  存放属于该组织的用户的实体</span></span><br><span class="line">    └── Admin@trade.com</span><br><span class="line">        ├── msp</span><br><span class="line">        │   ├── admincerts</span><br><span class="line">        │   │   └── Admin@trade.com-cert.pem</span><br><span class="line">        │   ├── cacerts</span><br><span class="line">        │   │   └── ca.trade.com-cert.pem</span><br><span class="line">        │   ├── keystore</span><br><span class="line">        │   │   └── 2187f9edda98eae3b2169a476e30aff6fb2781c19e6cb400671b723d7b74abde_sk</span><br><span class="line">        │   ├── signcerts</span><br><span class="line">        │   │   └── Admin@trade.com-cert.pem</span><br><span class="line">        │   └── tlscacerts</span><br><span class="line">        │       └── tlsca.trade.com-cert.pem</span><br><span class="line">        └── tls</span><br><span class="line">            ├── ca.crt</span><br><span class="line">            ├── client.crt</span><br><span class="line">            └── client.key</span><br></pre></td></tr></table></figure>
<p>我们可以知道cryptogen工具无非就是在各个资源下生成组织和私钥、证书等等，其中最关键的就是各个资源下的MSP目录内容：</p>
<pre><code>admincerts：    管理员的身份证书文件
cacerts：       信任的根证书文件
keystore：      节点的签名私钥文件
signcerts：     节点的签名身份证书文件
tlscacerts：    TLS连接用的证书
</code></pre><h4 id="3、通道及锚节点的配置-configtx-yaml-配置剖析"><a href="#3、通道及锚节点的配置-configtx-yaml-配置剖析" class="headerlink" title="3、通道及锚节点的配置  configtx.yaml 配置剖析"></a>3、通道及锚节点的配置  configtx.yaml 配置剖析</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Organizations:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="meta">&amp;TradeOrdererOrg</span></span><br><span class="line"><span class="attr">        Name:</span> <span class="string">TradeOrdererOrg</span> <span class="comment">#Orderer的组织的名称</span></span><br><span class="line"><span class="attr">        ID:</span> <span class="string">TradeOrdererMSP</span>   <span class="comment">#Orderer的组织的ID</span></span><br><span class="line">        <span class="comment"># MSPDir是包含Orderer的MSP证书目录路径</span></span><br><span class="line"><span class="attr">        MSPDir:</span> <span class="string">crypto-config/ordererOrganizations/trade.com/msp</span>  </span><br><span class="line">        </span><br><span class="line"><span class="bullet">    -</span> <span class="meta">&amp;ExporterOrg</span></span><br><span class="line"><span class="attr">        Name:</span> <span class="string">ExporterOrgMSP</span> </span><br><span class="line"><span class="attr">        ID:</span> <span class="string">ExporterOrgMSP</span></span><br><span class="line"><span class="attr">        MSPDir:</span> <span class="string">crypto-config/peerOrganizations/exporterorg.trade.com/msp</span></span><br><span class="line"><span class="attr">        AnchorPeers:</span></span><br><span class="line">            <span class="comment">#锚点定义可以使用的对等节点的位置</span></span><br><span class="line">            <span class="comment">#这些节点用于跨组织的信息交流。注意，这个值只是</span></span><br><span class="line">            <span class="comment">#用来加密应用程序部分上下文的创世区块</span></span><br><span class="line"><span class="attr">            - Host:</span> <span class="string">peer0.exporterorg.trade.com</span>  <span class="comment">##  锚节点的主机名</span></span><br><span class="line"><span class="attr">              Port:</span> <span class="number">7051</span>  <span class="comment">##  锚节点的端口号</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">    -</span> <span class="meta">&amp;ImporterOrg</span></span><br><span class="line"><span class="attr">        Name:</span> <span class="string">ImporterOrgMSP</span></span><br><span class="line"><span class="attr">        ID:</span> <span class="string">ImporterOrgMSP</span></span><br><span class="line"><span class="attr">        MSPDir:</span> <span class="string">crypto-config/peerOrganizations/importerorg.trade.com/msp</span></span><br><span class="line"><span class="attr">        AnchorPeers:</span></span><br><span class="line"><span class="attr">            - Host:</span> <span class="string">peer0.importerorg.trade.com</span></span><br><span class="line"><span class="attr">              Port:</span> <span class="number">7051</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">    -</span> <span class="meta">&amp;CarrierOrg</span></span><br><span class="line"><span class="attr">        Name:</span> <span class="string">CarrierOrgMSP</span></span><br><span class="line"><span class="attr">        ID:</span> <span class="string">CarrierOrgMSP</span></span><br><span class="line"><span class="attr">        MSPDir:</span> <span class="string">crypto-config/peerOrganizations/carrierorg.trade.com/msp</span></span><br><span class="line"><span class="attr">        AnchorPeers:</span></span><br><span class="line"><span class="attr">            - Host:</span> <span class="string">peer0.carrierorg.trade.com</span></span><br><span class="line"><span class="attr">              Port:</span> <span class="number">7051</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">    -</span> <span class="meta">&amp;RegulatorOrg</span></span><br><span class="line"><span class="attr">        Name:</span> <span class="string">RegulatorOrgMSP</span></span><br><span class="line"><span class="attr">        ID:</span> <span class="string">RegulatorOrgMSP</span></span><br><span class="line"><span class="attr">        MSPDir:</span> <span class="string">crypto-config/peerOrganizations/regulatororg.trade.com/msp</span></span><br><span class="line"><span class="attr">        AnchorPeers:</span></span><br><span class="line"><span class="attr">            - Host:</span> <span class="string">peer0.regulatororg.trade.com</span></span><br><span class="line"><span class="attr">              Port:</span> <span class="number">7051</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#   SECTION: Orderer</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Orderer:</span> <span class="meta">&amp;OrdererDefaults</span></span><br><span class="line"><span class="attr">    OrdererType:</span> <span class="string">solo</span>   <span class="comment">## Orderer类型，包含solo和kafka集群</span></span><br><span class="line"><span class="attr">    Addresses:</span>   <span class="comment">## 服务地址</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">orderer.trade.com:7050</span></span><br><span class="line"><span class="attr">    BatchTimeout:</span> <span class="number">2</span><span class="string">s</span> <span class="comment">##  区块打包的最大超时时间 (到了该时间就打包区块)</span></span><br><span class="line"><span class="attr">    BatchSize:</span></span><br><span class="line">        <span class="comment">#一个区块里最大的交易数</span></span><br><span class="line"><span class="attr">        MaxMessageCount:</span> <span class="number">10</span></span><br><span class="line">        <span class="comment"># 一个区块的最大字节数， 任何时候都不能超过</span></span><br><span class="line"><span class="attr">        AbsoluteMaxBytes:</span> <span class="number">99</span> <span class="string">MB</span></span><br><span class="line">        <span class="comment">#一个区块的建议字节数，如果一个交易消息的大小超过了这个值, 就会被放入另外一个更大的区块中</span></span><br><span class="line"><span class="attr">        PreferredMaxBytes:</span> <span class="number">512</span> <span class="string">KB</span></span><br><span class="line"><span class="attr">    Kafka:</span></span><br><span class="line"><span class="attr">        Brokers:</span>  <span class="comment">## kafka的 brokens 服务地址 允许有多个</span></span><br><span class="line"><span class="bullet">            -</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span></span><br><span class="line"><span class="attr">    Organizations:</span> <span class="comment">##  参与维护 Orderer 的组织，默认为空</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#   SECTION: Application</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Application:</span> <span class="meta">&amp;ApplicationDefaults</span> <span class="comment">## 自定义被引用的地址</span></span><br><span class="line"><span class="attr">    Organizations:</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#   SECTION: Capabilities</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Capabilities:</span></span><br><span class="line"><span class="attr">    Global:</span> <span class="meta">&amp;ChannelCapabilities</span></span><br><span class="line"><span class="attr">        V1_1:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    Orderer:</span> <span class="meta">&amp;OrdererCapabilities</span></span><br><span class="line"><span class="attr">        V1_1:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    Application:</span> <span class="meta">&amp;ApplicationCapabilities</span></span><br><span class="line"><span class="attr">        V1_1:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Profiles:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    FourOrgsTradeOrdererGenesis:</span></span><br><span class="line"><span class="attr">        Capabilities:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*ChannelCapabilities</span></span><br><span class="line"><span class="attr">        Orderer:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererDefaults</span></span><br><span class="line"><span class="attr">            Organizations:</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*TradeOrdererOrg</span></span><br><span class="line"><span class="attr">            Capabilities:</span></span><br><span class="line">                <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererCapabilities</span></span><br><span class="line"><span class="attr">        Consortiums:</span></span><br><span class="line"><span class="attr">            TradeConsortium:</span></span><br><span class="line"><span class="attr">                Organizations:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="meta">*ExporterOrg</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="meta">*ImporterOrg</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="meta">*CarrierOrg</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="meta">*RegulatorOrg</span></span><br><span class="line"><span class="attr">    FourOrgsTradeChannel:</span></span><br><span class="line"><span class="attr">        Consortium:</span> <span class="string">TradeConsortium</span></span><br><span class="line"><span class="attr">        Application:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*ApplicationDefaults</span></span><br><span class="line"><span class="attr">            Organizations:</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*ExporterOrg</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*ImporterOrg</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*CarrierOrg</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*RegulatorOrg</span></span><br><span class="line"><span class="attr">            Capabilities:</span></span><br><span class="line">                <span class="string">&lt;&lt;:</span> <span class="meta">*ApplicationCapabilities</span></span><br></pre></td></tr></table></figure>
<h4 id="4、通道工件配置channel-artifacts剖析"><a href="#4、通道工件配置channel-artifacts剖析" class="headerlink" title="4、通道工件配置channel-artifacts剖析"></a>4、通道工件配置channel-artifacts剖析</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ configtxgen -profile FourOrgsTradeOrdererGenesis -outputBlock ./channel-artifacts/genesis.block   <span class="comment">##生成创世区块</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ configtxgen -profile FourOrgsTradeChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID tradechannel <span class="comment">## 生成通道配置信息</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ configtxgen -profile FourOrgsTradeChannel -outputAnchorPeersUpdate ./channel-artifacts/ExporterOrgMSPanchors.tx -channelID tradechannel -asOrg ExporterOrgMSP</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ configtxgen -profile FourOrgsTradeChannel -outputAnchorPeersUpdate ./channel-artifacts/ImporterOrgMSPanchors.tx -channelID tradechannel -asOrg ImporterOrgMSP</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ configtxgen -profile FourOrgsTradeChannel -outputAnchorPeersUpdate ./channel-artifacts/CarrierOrgMSPanchors.tx -channelID tradechannel -asOrg CarrierOrgMSP</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ configtxgen -profile FourOrgsTradeChannel -outputAnchorPeersUpdate ./channel-artifacts/RegulatorOrgMSPanchor.tx -channelID tradechannel -asOrg RegulatorORGMSP</span><br></pre></td></tr></table></figure>
<p>以上命令均包含在./trade.sh中，该脚本还应包含将环境变量FABRIC_CFG_PATH设置为指向包含configtx.yaml文件的文件夹才能使configtxgen工具正常工作。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> PATH=<span class="variable">$&#123;PWD&#125;</span>/../bin:<span class="variable">$&#123;PWD&#125;</span>:<span class="variable">$PATH</span>   <span class="comment">##配置cryptogen环境变量（前面已配置，此例子无效）</span></span><br><span class="line">$ <span class="built_in">export</span> FABRIC_CFG_PATH=<span class="variable">$&#123;PWD&#125;</span>   <span class="comment">## $&#123;PWD&#125;获取当前目录路径的字符串值</span></span><br></pre></td></tr></table></figure>
<p>查看channel-artifacts文件夹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ tree channel-artifacts</span><br><span class="line">channel-artifacts/</span><br><span class="line">├── CarrierOrgMSPanchors.tx    <span class="comment">##Carrier组织MSP锚节点配置</span></span><br><span class="line">├── channel.tx                 <span class="comment">##通道配置</span></span><br><span class="line">├── ExporterOrgMSPanchors.tx   <span class="comment">##Exportor组织MSP锚节点配置</span></span><br><span class="line">├── genesis.block              <span class="comment">##创世区块</span></span><br><span class="line">├── ImporterOrgMSPanchors.tx   <span class="comment">##Importer组织MSP锚节点通道配置</span></span><br><span class="line">└── RegulatorOrgMSPanchors.tx  <span class="comment">##Regulator组织MSP锚节点通道配置</span></span><br></pre></td></tr></table></figure>
<h3 id="四、示例贸易网络分析"><a href="#四、示例贸易网络分析" class="headerlink" title="四、示例贸易网络分析"></a>四、示例贸易网络分析</h3><h4 id="1、相关docker镜像及配置"><a href="#1、相关docker镜像及配置" class="headerlink" title="1、相关docker镜像及配置"></a>1、相关docker镜像及配置</h4><p>hyperledger将该网络运行在三个docker镜像中，在前面的hyperledger fabric环境搭建中已经下拉了这些镜像，可以通过docker命令查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker images |grep hyperledger/fabric-[opc][^co].*[^-]latest</span><br><span class="line">hyperledger/fabric-orderer     latest     <span class="comment">## 用于orderer</span></span><br><span class="line">hyperledger/fabric-peer        latest     <span class="comment">## 用于peer</span></span><br><span class="line">hyperledger/fabric-ca          latest     <span class="comment">## 用于MSP</span></span><br></pre></td></tr></table></figure>
<p>与docker相关配置文件有三个peer-base.yaml、docker-compose-base.yaml和docker-compose-e2e.yaml，前者是后者的扩展（extends）。</p>
<h4 id="2、peer-base-yaml配置剖析"><a href="#2、peer-base-yaml配置剖析" class="headerlink" title="2、peer-base.yaml配置剖析"></a>2、peer-base.yaml配置剖析</h4><p>peer-base.yaml在./base 文件夹中，该配置定义了四个peer共同的相关配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span>   <span class="comment">#服务定义 开始标签</span></span><br><span class="line"><span class="attr">  peer-base:</span>   <span class="comment">#服务名</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">hyperledger/fabric-peer:$IMAGE_TAG</span>   <span class="comment">#docker镜像名</span></span><br><span class="line"><span class="attr">    environment:</span>   <span class="comment">#环境变量</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span></span><br><span class="line">      <span class="comment"># the following setting starts chaincode containers on the same</span></span><br><span class="line">      <span class="comment"># bridge network as the peers</span></span><br><span class="line">      <span class="comment"># https://docs.docker.com/compose/networking/</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=$&#123;COMPOSE_PROJECT_NAME&#125;_trade</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_LOGGING_LEVEL=INFO</span>    <span class="comment">#记录信息、警告和错误消息</span></span><br><span class="line">      <span class="comment">#- CORE_LOGGING_LEVEL=DEBUG</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_TLS_ENABLED=true</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_GOSSIP_USELEADERELECTION=true</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_GOSSIP_ORGLEADER=false</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_PROFILE_ENABLED=true</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span></span><br><span class="line"><span class="attr">    working_dir:</span> <span class="string">/opt/gopath/src/github.com/hyperledger/fabric/peer</span> <span class="comment">#工作路径</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">peer</span> <span class="string">node</span> <span class="string">start</span>  <span class="comment">#启动命令</span></span><br></pre></td></tr></table></figure>
<h4 id="3、docker-compose-base-yaml配置剖析"><a href="#3、docker-compose-base-yaml配置剖析" class="headerlink" title="3、docker-compose-base.yaml配置剖析"></a>3、docker-compose-base.yaml配置剖析</h4><p>docker-compose-base.yaml在./base文件夹中，该配置是每个对等节点具体的配置，以peer0.exporterorg.trade.com为例（其中orderer的配置与peer-base.yaml相似，可参考上面的配置）</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">peer0.exporterorg.trade.com:</span>   <span class="comment">#服务名</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">peer0.exporterorg.trade.com</span>     <span class="comment">#容器名</span></span><br><span class="line"><span class="attr">    extends:</span>  <span class="comment">#扩展配置</span></span><br><span class="line"><span class="attr">      file:</span> <span class="string">peer-base.yaml</span>   <span class="comment">#扩展配置文件</span></span><br><span class="line"><span class="attr">      service:</span> <span class="string">peer-base</span>     <span class="comment">#扩展配置服务</span></span><br><span class="line"><span class="attr">    environment:</span>   <span class="comment">#环境变量</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_ID=peer0.exporterorg.trade.com</span>   <span class="comment">#ID与configtx.yaml中相匹配</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_ADDRESS=peer0.exporterorg.trade.com:7051</span>  <span class="comment">#地址</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_GOSSIP_BOOTSTRAP=peer0.exporterorg.trade.com:7051</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.exporterorg.trade.com:7051</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_LOCALMSPID=ExporterOrgMSP</span>   <span class="comment">#MSP与configtx.yaml中相匹配</span></span><br><span class="line"><span class="attr">    volumes:</span>   <span class="comment">#挂载卷</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/var/run/:/host/var/run/</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">../crypto-config/peerOrganizations/exporterorg.trade.com/peers/peer0.exporterorg.trade.com/msp:/etc/hyperledger/fabric/msp</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">../crypto-config/peerOrganizations/exporterorg.trade.com/peers/peer0.exporterorg.trade.com/tls:/etc/hyperledger/fabric/tls</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">peer0.exporterorg.trade.com:/var/hyperledger/production</span></span><br><span class="line"><span class="attr">    ports:</span>  <span class="comment">#端口映射  host主机端口:容器内端口</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">7051</span><span class="string">:7051</span>   <span class="comment">#服务器侦听端口</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">7053</span><span class="string">:7053</span>   <span class="comment">#客户端订阅端口</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">7055</span><span class="string">:6060</span></span><br></pre></td></tr></table></figure>
<h4 id="4、docker-compose-e2e-yaml配置剖析"><a href="#4、docker-compose-e2e-yaml配置剖析" class="headerlink" title="4、docker-compose-e2e.yaml配置剖析"></a>4、docker-compose-e2e.yaml配置剖析</h4><p>docker-compose-e2e.yaml，由命令./trade.sh generate -c tradechannel创建，依赖于base / docker-compose-base.yaml（以及间接base / peer-base.yaml），从名为docker-compose-e2e-template.yaml的模板YAML文件创建（同一文件夹）。以exporter-ca为例查看相关MSP配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span>   <span class="comment">#服务定义 开始标签</span></span><br><span class="line"><span class="attr">  exporter-ca:</span>  <span class="comment">#服务名</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">hyperledger/fabric-ca:$IMAGE_TAG</span>   <span class="comment">#docker镜像</span></span><br><span class="line"><span class="attr">    environment:</span>   <span class="comment">#环境变量</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server</span>  <span class="comment">#在MSP中运行的服务名</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">FABRIC_CA_SERVER_CA_NAME=ca-exporterorg</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">FABRIC_CA_SERVER_TLS_ENABLED=true</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.exporterorg.trade.com-cert.pem</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/6842d1c3a357472cc249fe42d3e97ffe7ba0210ab89781a3fdd73cbc30f8934b_sk</span></span><br><span class="line"><span class="attr">    ports:</span>   <span class="comment">#端口映射  host主机端口:容器内端口</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"7054:7054"</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">sh</span> <span class="bullet">-c</span> <span class="string">'fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.exporterorg.trade.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/6842d1c3a357472cc249fe42d3e97ffe7ba0210ab89781a3fdd73cbc30f8934b_sk -b admin:adminpw -d'</span>    <span class="comment">#启动命令  默认登录名和密码（分别为admin和adminpw）</span></span><br><span class="line"><span class="attr">    volumes:</span>   <span class="comment">#挂载卷</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./crypto-config/peerOrganizations/exporterorg.trade.com/ca/:/etc/hyperledger/fabric-ca-server-config</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">ca_peerExporterOrg</span>    <span class="comment">#容器名</span></span><br><span class="line"><span class="attr">    networks:</span>  <span class="comment">#所处网络</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">trade</span></span><br></pre></td></tr></table></figure>
<h3 id="五、启动样本交易网络"><a href="#五、启动样本交易网络" class="headerlink" title="五、启动样本交易网络"></a>五、启动样本交易网络</h3><h4 id="1、启动网络"><a href="#1、启动网络" class="headerlink" title="1、启动网络"></a>1、启动网络</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$./trade.sh up -c tradechannel</span><br></pre></td></tr></table></figure>
<h4 id="2、查看docker进程"><a href="#2、查看docker进程" class="headerlink" title="2、查看docker进程"></a>2、查看docker进程</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps <span class="comment">#查看docker进程</span></span><br><span class="line">CONTAINER ID        IMAGE                               COMMAND                  CREATED             STATUS              PORTS                                                                       NAMES</span><br><span class="line">a716239d97ad        hyperledger/fabric-peer:latest      <span class="string">"peer node start"</span>        26 seconds ago      Up 11 seconds       0.0.0.0:9055-&gt;6060/tcp, 0.0.0.0:9051-&gt;7051/tcp, 0.0.0.0:9053-&gt;7053/tcp      peer0.carrierorg.trade.com</span><br><span class="line">c3ce947f9490        hyperledger/fabric-peer:latest      <span class="string">"peer node start"</span>        26 seconds ago      Up 12 seconds       0.0.0.0:8055-&gt;6060/tcp, 0.0.0.0:8051-&gt;7051/tcp, 0.0.0.0:8053-&gt;7053/tcp      peer0.importerorg.trade.com</span><br><span class="line">f8bae3919c76        hyperledger/fabric-peer:latest      <span class="string">"peer node start"</span>        26 seconds ago      Up 11 seconds       0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp, 0.0.0.0:7055-&gt;6060/tcp      peer0.exporterorg.trade.com</span><br><span class="line">f7fc7b67ab61        hyperledger/fabric-ca:latest        <span class="string">"sh -c 'fabric-ca-se…"</span>   26 seconds ago      Up 14 seconds       0.0.0.0:7054-&gt;7054/tcp                                                      ca_peerExporterOrg</span><br><span class="line">5c23b50bfbf7        hyperledger/fabric-peer:latest      <span class="string">"peer node start"</span>        26 seconds ago      Up 9 seconds        0.0.0.0:10055-&gt;6060/tcp, 0.0.0.0:10051-&gt;7051/tcp, 0.0.0.0:10053-&gt;7053/tcp   peer0.regulatororg.trade.com</span><br><span class="line">6e0235be3e7e        hyperledger/fabric-ca:latest        <span class="string">"sh -c 'fabric-ca-se…"</span>   26 seconds ago      Up 9 seconds        0.0.0.0:8054-&gt;7054/tcp                                                      ca_peerImporterOrg</span><br><span class="line">2e47cb0610fc        hyperledger/fabric-orderer:latest   <span class="string">"orderer"</span>                26 seconds ago      Up 13 seconds       0.0.0.0:7050-&gt;7050/tcp                                                      orderer.trade.com</span><br><span class="line">d6e0acddea54        hyperledger/fabric-ca:latest        <span class="string">"sh -c 'fabric-ca-se…"</span>   27 seconds ago      Up 15 seconds       0.0.0.0:10054-&gt;7054/tcp                                                     ca_peerRegulatorOrg</span><br><span class="line">918e7707db2a        hyperledger/fabric-ca:latest        <span class="string">"sh -c 'fabric-ca-se…"</span>   27 seconds ago      Up 17 seconds       0.0.0.0:9054-&gt;7054/tcp                                                      ca_peerCarrierOrg</span><br></pre></td></tr></table></figure>
<p>hyperledger/fabric-orderer：启动一个orderer服务</p>
<p>hyperledger/fabric-peer：启动四个peer服务</p>
<p>hyperledger/fabric-ca：启动四个peer的MSP服务</p>
<h4 id="3、查看服务"><a href="#3、查看服务" class="headerlink" title="3、查看服务"></a>3、查看服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker logs &lt;container-ID&gt; <span class="comment">#查看容器的运行日志</span></span><br><span class="line">$ docker attach &lt;container-ID&gt; <span class="comment">#进入容器交互界面</span></span><br></pre></td></tr></table></figure>
<h4 id="4、关闭网络"><a href="#4、关闭网络" class="headerlink" title="4、关闭网络"></a>4、关闭网络</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./trade.sh down -c tradechannel</span><br></pre></td></tr></table></figure>
<h3 id="六、总结"><a href="#六、总结" class="headerlink" title="六、总结"></a>六、总结</h3><p>以上是个人学习hyperledger fabric的一些理解和整理，欢迎参考、交流和指正。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">kangel</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章鏈接: </span><span class="post-copyright-info"><a href="https://j-kangel.github.io/2019/03/28/trade-finance/">https://j-kangel.github.io/2019/03/28/trade-finance/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版權聲明: </span><span class="post-copyright-info">本博客所有文章除特別聲明外，均採用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 許可協議。轉載請註明來自 <a href="https://j-kangel.github.io" target="_blank">KANGEL</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/blockchain/">blockchain    </a><a class="post-meta__tags" href="/tags/hyperledger/">hyperledger    </a></div><div class="post_share"></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/04/05/hash-attack/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>hash长度扩展攻击</span></div></a></div><div class="next-post pull_right"><a href="/2019/03/25/docker/"><img class="next_cover lazyload" data-src="/article_cover/0-7.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>使用docker部署静态网站</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相關推薦</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2019/08/15/fabric-node-sdk/" title="fabric_node_sdk的编写与运行"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><div class="relatedPosts_title">fabric_node_sdk的编写与运行</div></a></div><div class="relatedPosts_item"><a href="/2019/03/24/hyperledger/" title="Ubuntu 16.04 搭建hyperledger fabric 1.4"><img class="relatedPosts_cover lazyload"data-src="/article_cover/0-16.jpg"><div class="relatedPosts_title">Ubuntu 16.04 搭建hyperledger fabric 1.4</div></a></div></div><div class="clear_both"></div></div></div></div><footer id="footer" style="background-image: url(/article_cover/0-6.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2019 By kangel</div><div class="framework-info"><span>Power by </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://j-kangel.github.io/">blog</a>!</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="閲讀模式"></i><i class="fa fa-plus" id="font_plus" title="放大字體"></i><i class="fa fa-minus" id="font_minus" title="縮小字體"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="簡繁轉換" target="_self">简</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜間模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="設置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目錄" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到頂部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.15/dist/snackbar.min.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>